<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>æ»‘åŠ¨AIä»£ç ç¼–è¾‘å™¨ Â· ç§»åŠ¨ä¼˜å…ˆ</title>
    <!-- CodeMirror 5 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            background: #1e1e2f;
            color: #f0f0f0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .toolbar {
            background: #2a2a3a;
            padding: 8px 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            border-bottom: 1px solid #3d3d5a;
            flex-shrink: 0;
        }
        .toolbar input[type="text"] {
            flex: 2;
            min-width: 200px;
            background: #1e1e2f;
            border: 1px solid #4a4a6a;
            border-radius: 30px;
            padding: 8px 15px;
            color: #fff;
            font-size: 14px;
        }
        .toolbar input[type="password"] {
            flex: 1;
            min-width: 150px;
            background: #1e1e2f;
            border: 1px solid #4a4a6a;
            border-radius: 30px;
            padding: 8px 15px;
            color: #fff;
            font-size: 14px;
        }
        .toolbar button {
            background: #4a4a6a;
            border: none;
            border-radius: 30px;
            padding: 8px 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            white-space: nowrap;
        }
        .toolbar button:hover {
            background: #5f5f8a;
        }
        .toolbar button.primary {
            background: #2a6fb0;
        }
        .toolbar button.primary:hover {
            background: #3a8fd0;
        }

        /* ä¸»å®¹å™¨ï¼šæ¡Œé¢ç«¯å¹¶æ’ï¼Œç§»åŠ¨ç«¯æ»‘åŠ¨ */
        .main {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* æ»‘åŠ¨å®¹å™¨ï¼ˆä»…ç§»åŠ¨ç«¯ç”Ÿæ•ˆï¼‰ */
        .swipe-container {
            display: flex;
            width: 100%;
            height: 100%;
            scroll-snap-type: x mandatory;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* éšè—æ»šåŠ¨æ¡ Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }
        .swipe-container::-webkit-scrollbar {
            display: none; /* éšè—æ»šåŠ¨æ¡ Chrome/Safari */
        }

        /* æ»‘åŠ¨é¡µ */
        .swipe-page {
            flex: 0 0 100%;
            height: 100%;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            overflow: hidden;
        }

        /* ç¼–è¾‘å™¨é¢æ¿å’Œé¢„è§ˆé¢æ¿å°†æ”¾å…¥æ»‘åŠ¨é¡µä¸­ */
        .editor-panel, .preview-panel {
            width: 100%;
            height: 100%;
        }

        .preview-panel {
            background: white;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        .CodeMirror {
            height: 100%;
            font-size: 14px;
        }

        /* æ¡Œé¢ç«¯æ ·å¼ï¼ˆå®½åº¦ > 768pxï¼‰ */
        @media (min-width: 769px) {
            .swipe-container {
                scroll-snap-type: none;
                overflow-x: visible;
            }
            .swipe-page {
                flex: 1;  /* ä¸¤é¡µå„å ä¸€åŠ */
                scroll-snap-align: none;
            }
            .editor-panel {
                border-right: 1px solid #3d3d5a;
            }
        }

        /* ç§»åŠ¨ç«¯æç¤ºç‚¹ï¼ˆå¯é€‰ï¼‰ */
        .page-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 4px 0;
            background: #2a2a3a;
            border-top: 1px solid #3d3d5a;
        }
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #5f5f8a;
            transition: background 0.2s;
        }
        .dot.active {
            background: #2a6fb0;
        }

        .status {
            background: #2a2a3a;
            padding: 4px 12px;
            font-size: 13px;
            color: #a0a0c0;
            border-top: 1px solid #3d3d5a;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <input type="text" id="promptInput" placeholder="AIæŒ‡ä»¤ï¼šä¾‹å¦‚ã€ŒæŠŠèƒŒæ™¯æ”¹æˆæ·±è‰²ã€ã€Œæ·»åŠ ä¸€ä¸ªæŒ‰é’®ã€">
        <input type="password" id="apiKeyInput" placeholder="DeepSeek API Key (å¯é€‰)" value="">
        <button id="sendBtn" class="primary">ğŸš€ æ‰§è¡ŒAIä¿®æ”¹</button>
        <button id="resetBtn">â†º é‡ç½®ç¤ºä¾‹</button>
        <button id="clearBtn">ğŸ—‘ï¸ ä¸€é”®æ¸…ç©º</button>
        <button id="importBtn">ğŸ“‚ å¯¼å…¥æ•°æ®</button>
    </div>
    <div class="main">
        <div class="swipe-container" id="swipeContainer">
            <!-- é¡µé¢1ï¼šç¼–è¾‘å™¨ -->
            <div class="swipe-page">
                <div class="editor-panel">
                    <textarea id="codeEditor"><!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå®æ—¶ç¼–è¾‘ç¤ºä¾‹</title>
    <style>
        body {
            font-family: system-ui;
            background: #f5f5f7;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .card {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 {
            color: #333;
        }
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
        }
        button:hover {
            background: #357abd;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ä½ å¥½ï¼ŒAIç¼–è¾‘å™¨ï¼</h1>
        <p>å‘å·¦æ»‘åŠ¨æŸ¥çœ‹é¢„è§ˆ</p>
        <button onclick="alert('ç‚¹å‡»äº†æŒ‰é’®')">ç‚¹å‡»æˆ‘</button>
    </div>
</body>
</html></textarea>
                </div>
            </div>
            <!-- é¡µé¢2ï¼šé¢„è§ˆ -->
            <div class="swipe-page">
                <div class="preview-panel">
                    <iframe id="preview" sandbox="allow-scripts allow-forms allow-same-origin" srcdoc=""></iframe>
                </div>
            </div>
        </div>
    </div>
    <!-- ç§»åŠ¨ç«¯æŒ‡ç¤ºç‚¹ -->
    <div class="page-indicator" id="indicator">
        <span class="dot active"></span>
        <span class="dot"></span>
    </div>
    <div class="status" id="status">å°±ç»ªã€‚è¾“å…¥AIæŒ‡ä»¤å¹¶æ‰§è¡Œï¼Œä»£ç ä¼šè‡ªåŠ¨ä¿®æ”¹ï¼ˆéœ€è¦æœ‰æ•ˆçš„DeepSeek API Keyï¼‰ã€‚</div>

    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥æ¡†ï¼Œç”¨äºå¯¼å…¥æ•°æ® -->
    <input type="file" id="fileInput" accept=".html,.htm,text/html" style="display: none;">

    <script>
        // åˆå§‹åŒ–CodeMirror
        const textarea = document.getElementById('codeEditor');
        const editor = CodeMirror.fromTextArea(textarea, {
            lineNumbers: true,
            mode: 'htmlmixed',
            theme: 'dracula',
            indentUnit: 4,
            lineWrapping: true,
            autoCloseTags: true,
            matchBrackets: true
        });

        const previewFrame = document.getElementById('preview');
        const promptInput = document.getElementById('promptInput');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const sendBtn = document.getElementById('sendBtn');
        const resetBtn = document.getElementById('resetBtn');
        const clearBtn = document.getElementById('clearBtn');
        const importBtn = document.getElementById('importBtn');
        const fileInput = document.getElementById('fileInput');
        const statusDiv = document.getElementById('status');
        const swipeContainer = document.getElementById('swipeContainer');
        const dots = document.querySelectorAll('.dot');

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const code = editor.getValue();
            previewFrame.srcdoc = code;
        }
        editor.on('change', updatePreview);
        updatePreview();

        // ç›‘å¬æ»‘åŠ¨ï¼Œæ›´æ–°æŒ‡ç¤ºç‚¹
        swipeContainer.addEventListener('scroll', () => {
            const scrollLeft = swipeContainer.scrollLeft;
            const pageWidth = swipeContainer.clientWidth;
            const activeIndex = Math.round(scrollLeft / pageWidth);
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === activeIndex);
            });
        });

        // é‡ç½®ç¤ºä¾‹
        resetBtn.addEventListener('click', () => {
            const demo = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå®æ—¶ç¼–è¾‘ç¤ºä¾‹</title>
    <style>
        body {
            font-family: system-ui;
            background: #f5f5f7;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .card {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 {
            color: #333;
        }
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
        }
        button:hover {
            background: #357abd;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ä½ å¥½ï¼ŒAIç¼–è¾‘å™¨ï¼</h1>
        <p>å‘å·¦æ»‘åŠ¨æŸ¥çœ‹é¢„è§ˆ</p>
        <button onclick="alert('ç‚¹å‡»äº†æŒ‰é’®')">ç‚¹å‡»æˆ‘</button>
    </div>
</body>
</html>`;
            editor.setValue(demo);
            statusDiv.innerText = 'å·²é‡ç½®ç¤ºä¾‹ä»£ç ã€‚';
        });

        // ä¸€é”®æ¸…ç©º
        clearBtn.addEventListener('click', () => {
            editor.setValue('');
            statusDiv.innerText = 'ç¼–è¾‘å™¨å·²æ¸…ç©ºã€‚';
        });

        // å¯¼å…¥æ•°æ®ï¼šè§¦å‘æ–‡ä»¶é€‰æ‹©
        importBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                editor.setValue(content);
                statusDiv.innerText = `å·²å¯¼å…¥æ–‡ä»¶ï¼š${file.name}`;
                // æ¸…ç©ºfile inputï¼Œä»¥ä¾¿å†æ¬¡é€‰æ‹©åŒä¸€ä¸ªæ–‡ä»¶
                fileInput.value = '';
            };
            reader.onerror = () => {
                statusDiv.innerText = 'âŒ æ–‡ä»¶è¯»å–å¤±è´¥';
                fileInput.value = '';
            };
            reader.readAsText(file);
        });

        // AIä¿®æ”¹
        async function callAI() {
            const prompt = promptInput.value.trim();
            if (!prompt) {
                statusDiv.innerText = 'âŒ è¯·è¾“å…¥æŒ‡ä»¤';
                return;
            }

            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                statusDiv.innerText = 'âŒ è¯·è¾“å…¥DeepSeek API Keyï¼ˆå…è´¹ç”³è¯·ï¼šplatform.deepseek.comï¼‰';
                return;
            }

            const currentCode = editor.getValue();
            statusDiv.innerText = 'â³ AIæ€è€ƒä¸­...';
            sendBtn.disabled = true;

            try {
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘åŠ©æ‰‹ã€‚è¯·æ ¹æ®ç”¨æˆ·æŒ‡ä»¤ä¿®æ”¹æä¾›çš„HTMLä»£ç ï¼Œè¾“å‡ºå®Œæ•´çš„HTMLæ–‡æ¡£ã€‚ä¿æŒä»£ç ç®€æ´ï¼Œä¸è¦æ·»åŠ é¢å¤–è§£é‡Šã€‚'
                            },
                            {
                                role: 'user',
                                content: `å½“å‰HTMLä»£ç ï¼š\n${currentCode}\n\nä¿®æ”¹è¦æ±‚ï¼š${prompt}\n\nè¯·è¿”å›ä¿®æ”¹åçš„å®Œæ•´HTMLä»£ç ï¼Œåªè¿”å›ä»£ç ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚`
                            }
                        ],
                        temperature: 0.5,
                        max_tokens: 4000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP ${response.status}`);
                }

                const data = await response.json();
                let newCode = data.choices[0].message.content;

                // æ¸…ç†markdownä»£ç å—
                newCode = newCode.replace(/^```html\s*|```\s*$/gi, '').trim();

                if (newCode) {
                    editor.setValue(newCode);
                    statusDiv.innerText = 'âœ… AIä¿®æ”¹å®Œæˆï¼';
                } else {
                    statusDiv.innerText = 'âš ï¸ AIè¿”å›å†…å®¹ä¸ºç©º';
                }

            } catch (error) {
                console.error(error);
                statusDiv.innerText = `âŒ é”™è¯¯ï¼š${error.message}`;
            } finally {
                sendBtn.disabled = false;
            }
        }

        sendBtn.addEventListener('click', callAI);

        promptInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                callAI();
            }
        });

        // ä¿å­˜API Keyåˆ°localStorage
        const savedKey = localStorage.getItem('deepseek_api_key');
        if (savedKey) {
            apiKeyInput.value = savedKey;
        }
        apiKeyInput.addEventListener('change', () => {
            localStorage.setItem('deepseek_api_key', apiKeyInput.value);
        });

        // æç¤º
        console.log('æ»‘åŠ¨AIç¼–è¾‘å™¨å·²å¯åŠ¨ã€‚æ–°å¢ä¸€é”®æ¸…ç©ºå’Œå¯¼å…¥æ•°æ®åŠŸèƒ½ã€‚');
    </script>
</body>
</html>