<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒè‰²çƒç»¼åˆåˆ†æç³»ç»Ÿ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "PingFang SC", "Helvetica Neue", Arial, sans-serif; }
        body { background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%); color: #e0e0e0; line-height: 1.5; padding: 10px; font-size: 14px; min-height: 100vh; }
        .container { max-width: 100%; margin: 0 auto; }
        
        /* å¤´éƒ¨æ ·å¼ */
        .header { display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border-radius: 8px; padding: 15px 20px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 2px solid #8a2be2; }
        .header-title { font-size: 20px; font-weight: bold; color: white; text-align: center; flex: 1; }
        .excel-import-btn { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); border: none; border-radius: 6px; padding: 12px 20px; color: white; font-size: 14px; cursor: pointer; box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3); transition: all 0.3s ease; min-width: 140px; }
        .excel-import-btn:hover { background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4); }
        .excel-import-btn.success { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); box-shadow: 0 2px 8px rgba(46, 204, 113, 0.3); }
        .excel-import-btn.success:hover { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4); }
        
        /* ç­›é€‰åŒºåŸŸæ ·å¼ */
        .filter-section { display: flex; background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border-radius: 8px; padding: 12px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); gap: 12px; border: 2px solid #8a2be2; }
        .filter-item { display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0; }
        .filter-label.vertical { writing-mode: vertical-lr; text-orientation: mixed; text-align: center; line-height: 1.2; min-height: 40px; color: #bdc3c7; }
        .filter-item select { flex: 1; padding: 8px 10px; border: 1px solid #4a5f7a; border-radius: 4px; font-size: 14px; background: #1e2a3a; color: #ecf0f1; min-width: 0; }

        /* æ—¥æœŸæ˜¾ç¤ºæ ·å¼ */
        .date-display { display: flex; justify-content: center; align-items: center; min-width: 120px; height: 20px; }
        .current-date { color: #FFD700; font-weight: bold; font-size: 16px; text-align: center; line-height: 1; }

        /* æ•°æ®åŒºåŸŸæ ·å¼ */
        .data-section { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.3); margin-bottom: 12px; border: 2px solid #8a2be2; }
        .section-title { padding: 10px 12px; font-size: 14px; font-weight: 600; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); display: flex; justify-content: space-between; align-items: center; color: white; cursor: pointer; }
        .collapse-btn { background: none; border: none; font-size: 14px; color: #8a2be2; padding: 0; width: 24px; height: 20px; display: flex; align-items: center; justify-content: center; transition: transform 0.3s ease; }
        .table-container { position: relative; overflow-x: auto; -webkit-overflow-scrolling: touch; transition: max-height 0.3s ease; scrollbar-width: none; -ms-overflow-style: none; }
        .table-container::-webkit-scrollbar { display: none; }
        .table-container.collapsed { max-height: 0; overflow: hidden; }
        
        /* è¡¨æ ¼é€šç”¨æ ·å¼ */
        .data-table { width: 100%; border-collapse: collapse; position: relative; }
        .data-table th, .data-table td { padding: 4px 3px; text-align: center; font-size: 11px; border: 1px solid #4a5f7a; white-space: nowrap; height: 24px; position: relative; }
        .data-table thead th { position: -webkit-sticky; position: sticky; top: 0; z-index: 100; background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); font-weight: 600; color: #ecf0f1; border-bottom: 2px solid #4a5f7a; transform: translateZ(0); }
        .group-header { position: -webkit-sticky; position: sticky; top: 0; z-index: 110; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); transform: translateZ(0); }
        
        /* è“çƒèµ°åŠ¿è¡¨æ ¼æ ·å¼ */
        #blueTable { min-width: 900px; }
        #blueTable thead tr:nth-child(2) th { top: 28px; transform: translateZ(0); }
        
        /* è“çƒèµ°åŠ¿è¡¨æ ¼åˆ†å‰²çº¿ */
        #blueTable thead tr:nth-child(2) th:nth-child(3),
        #blueTable td:nth-child(3) { border-right: 2px solid #f39c12 !important; }
        #blueTable thead tr:nth-child(2) th:nth-child(5),
        #blueTable td:nth-child(5) { border-right: 2px solid #e74c3c !important; }
        #blueTable thead tr:nth-child(2) th:nth-child(7),
        #blueTable td:nth-child(7) { border-right: 2px solid #3498db !important; }
        #blueTable thead tr:nth-child(2) th:nth-child(10),
        #blueTable td:nth-child(10) { border-right: 2px solid #2ecc71 !important; }
        #blueTable thead tr:nth-child(2) th:nth-child(13),
        #blueTable td:nth-child(13) { border-right: 2px solid #9b59b6 !important; }
        #blueTable thead tr:nth-child(2) th:nth-child(21),
        #blueTable td:nth-child(21) { border-right: 2px solid #1abc9c !important; }
        
        /* ä¸€äºŒåŒºè“çƒèµ°åŠ¿è¿æ¥çº¿ */
        .zone-trend-line {
            position: absolute;
            background: linear-gradient(135deg, #e74c3c, #f39c12);
            height: 2px;
            transform-origin: left center;
            z-index: 5;
            pointer-events: none;
        }
        
        /* çƒä½“æ ·å¼ */
        .ball-3d { 
            width: 20px; 
            height: 20px; 
            border-radius: 50%; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 10px; 
            font-weight: bold; 
            margin: 0 auto; 
            position: relative; 
            box-shadow: inset -2px -2px 6px rgba(0, 0, 0, 0.6), inset 2px 2px 6px rgba(255, 255, 255, 0.2), 0 3px 8px rgba(0, 0, 0, 0.4); 
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); 
            z-index: 10;
        }
        .blue-ball-3d { 
            background: linear-gradient(135deg, #3498db 0%, #1a5276 100%); 
            color: white; 
            border: 1px solid #2980b9; 
        }
        .red-ball-3d {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: 1px solid #c0392b;
        }
        .zone-1-ball, .zone-2-ball { 
            width: 18px; 
            height: 18px; 
            color: white; 
            border: 1px solid; 
            z-index: 10;
        }
        .zone-1-ball { 
            background: linear-gradient(135deg, #3498db 0%, #1a5276 100%); 
            border-color: #2980b9; 
        }
        .zone-2-ball { 
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); 
            border-color: #229954; 
        }
        
        /* ä¸€äºŒåŒºè“çƒå•å…ƒæ ¼å®¹å™¨ */
        .zone-cell { position: relative; height: 24px; }
        
        /* æŒ‡å®šåŒºåŸŸå­—ä½“14px */
        #blueTable td:nth-child(4),  /* å¤§ */
        #blueTable td:nth-child(5),  /* å° */
        #blueTable td:nth-child(6),  /* å¥‡ */
        #blueTable td:nth-child(7),  /* å¶ */
        #blueTable td:nth-child(8),  /* 0è·¯ */
        #blueTable td:nth-child(9),  /* 1è·¯ */
        #blueTable td:nth-child(10), /* 2è·¯ */
        #blueTable td:nth-child(11), /* 0ç»Ÿè®¡ */
        #blueTable td:nth-child(12), /* 1ç»Ÿè®¡ */
        #blueTable td:nth-child(13)  /* 2ç»Ÿè®¡ */
        { 
            font-size: 14px !important; 
            font-weight: bold !important; 
        }
        
        /* æ–‡å­—æ ·å¼ */
        .size-big { color: #e74c3c; font-weight: 600; font-size: 14px !important; }
        .size-small { color: #2ecc71; font-weight: 600; font-size: 14px !important; }
        .odd { color: #3498db; font-weight: 600; font-size: 14px !important; }
        .even { color: #9b59b6; font-weight: 600; font-size: 14px !important; }
        .road-0 { color: #f39c12; font-weight: 600; font-size: 14px !important; }
        .road-1 { color: #1abc9c; font-weight: 600; font-size: 14px !important; }
        .road-2 { color: #e74c3c; font-weight: 600; font-size: 14px !important; }
        .stat-cell { font-weight: bold; color: #ecf0f1; font-size: 14px !important; }
        .stat-zero { color: #7f8c8d; font-weight: normal; font-size: 14px !important; }
        .stat-one { color: #f1c40f; font-weight: bold; font-size: 14px !important; }
        
        /* ä¸€åŒºè“çƒè¡¨å¤´æ•°å­—é¢œè‰² - è“è‰² */
        #blueTable thead tr:nth-child(2) th:nth-child(n+14):nth-child(-n+21) {
            color: #3498db; /* è“è‰² */
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* äºŒåŒºè“çƒè¡¨å¤´æ•°å­—é¢œè‰² - ç»¿è‰² */
        #blueTable thead tr:nth-child(2) th:nth-child(n+22):nth-child(-n+29) {
            color: #2ecc71; /* ç»¿è‰² */
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        /* è¿‡æ»¤åˆ†æåŒºåŸŸ */
        .filter-panel { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border-radius: 8px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 2px solid #8a2be2; }
        .filter-section-inner { margin-bottom: 25px; }
        .filter-title { font-weight: bold; margin-bottom: 10px; color: white; font-size: 14px; }
        .filter-options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
        .road-options { display: flex; gap: 8px; margin-bottom: 12px; }
        .road-options .filter-btn { flex: 1; }
        
        .filter-btn { 
            position: relative; 
            padding: 10px 8px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s; 
            font-size: 15px;
            text-align: center; 
            font-weight: bold; 
            color: white; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3); 
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.2), 0 8px 15px rgba(0, 0, 0, 0.3); 
        }
        .filter-btn.small { background: #2ecc71; }
        .filter-btn.big { background: #6F4E37; }
        .filter-btn.odd { background: #9b59b6; }
        .filter-btn.even { background: #f39c12; }
        .filter-btn.road0 { background: #d35400; }
        .filter-btn.road1 { background: #004B8D; }
        .filter-btn.road2 { background: #1abc9c; }

        .filter-btn.active {
            box-shadow: 0 8px 0 #ffffff, 0 8px 0 rgba(255, 255, 255, 0.9), 0 12px 25px rgba(255, 255, 255, 0.4);
            transform: translateY(2px);
        }

        .filter-btn:active { transform: translateY(4px); }
        .filter-btn.active:active { transform: translateY(8px); box-shadow: 0 0 0 #ffffff, 0 2px 5px rgba(255, 255, 255, 0.3); }
        
        .balls-grid { display: grid; grid-template-columns: repeat(8, 1fr); row-gap: 25px !important; column-gap: 8px; margin: 20px 0; }
        .kill-ball { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; cursor: pointer; font-size: 14px; font-weight: bold; color: white; transition: all 0.3s ease; position: relative; box-shadow: inset -2px -2px 6px rgba(0, 0, 0, 0.6), inset 2px 2px 6px rgba(255, 255, 255, 0.2), 0 3px 8px rgba(0, 0, 0, 0.4); text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); margin: 0 auto; }
        .kill-ball.small-ball { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); border: 1px solid #229954; }
        .kill-ball.big-ball { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); border: 1px solid #c0392b; }
        .kill-ball:hover { transform: scale(1.05); }
        .kill-ball.excluded { background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%) !important; transform: scale(0.85); opacity: 0.6; }
        .kill-ball.excluded::after { content: "âœ•"; position: absolute; top: -3px; right: -3px; background: #e74c3c; width: 15px; height: 15px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        
        .filter-controls { display: flex; justify-content: space-between; margin-top: 20px; }
        .kill-text { font-weight: bold; color: white; font-size: 14px; display: flex; align-items: center; }
        .reset-btn { position: relative; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; font-size: 14px; background-color: #e74c3c; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); box-shadow: 0 6px 0 rgba(0, 0, 0, 0.2), 0 8px 15px rgba(0, 0, 0, 0.3); }
        .reset-btn.active { box-shadow: 0 8px 0 #ffffff, 0 8px 0 rgba(255, 255, 255, 0.9), 0 12px 25px rgba(255, 255, 255, 0.4); }
        .reset-btn:active { transform: translateY(4px); }
        .reset-btn.active:active { transform: translateY(8px); box-shadow: 0 0 0 #ffffff, 0 2px 5px rgba(255, 255, 255, 0.3); }
        
        .filter-result { background: linear-gradient(135deg, #3498db, #2c3e50); color: white; padding: 20px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .result-title { font-weight: bold; margin-bottom: 15px; text-align: center; font-size: 18px; }
        .result-numbers { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 12px; min-height: 60px; margin-top: 20px; }
        .result-number { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); font-weight: bold; font-size: 18px; animation: pulse 2s infinite; box-shadow: inset -2px -2px 6px rgba(0, 0, 0, 0.6), inset 2px 2px 6px rgba(255, 255, 255, 0.2), 0 3px 8px rgba(0, 0, 0, 0.4); text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); }
        .no-result { color: #bdc3c7; font-style: italic; text-align: center; font-size: 14px; margin-top: 20px; }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        /* ç­›é€‰åŠŸèƒ½åŒºè¡¨æ ¼æ ·å¼ */
        #roadTable { min-width: 1500px; border: 1px solid #4a5f7a; }
        #roadTable th, #roadTable td { border-bottom: 1px solid #5a7a9a; border-right: 1px solid #5a7a9a; }
        #roadTable thead tr:nth-child(2) th { top: 28px; }
        .group-header { border-bottom: 2px solid #8a2be2; border-right: none !important; }

        /* åˆ†éš”çº¿æ ·å¼ */
        #roadTable thead tr:nth-child(2) th:nth-child(2),
        #roadTable td:nth-child(2) { border-right: 2px solid #3498db !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(9),
        #roadTable td:nth-child(9) { border-right: 2px solid #e74c3c !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(15),
        #roadTable td:nth-child(15) { border-right: 2px solid #2ecc71 !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(21),
        #roadTable td:nth-child(21) { border-right: 2px solid #f39c12 !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(27),
        #roadTable td:nth-child(27) { border-right: 2px solid #9b59b6 !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(33),
        #roadTable td:nth-child(33) { border-right: 2px solid #1abc9c !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(36),
        #roadTable td:nth-child(36) { border-right: 2px solid #d35400 !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(39),
        #roadTable td:nth-child(39) { border-right: 2px solid #F4D03F !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(41),
        #roadTable td:nth-child(41) { border-right: 2px solid #FFB7C5 !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(43),
        #roadTable td:nth-child(43) { border-right: 2px solid #7CFC00 !important; }
        #roadTable thead tr:nth-child(2) th:nth-child(45),
        #roadTable td:nth-child(45) { border-right: 2px solid #FF69B4 !important; }

        /* åº•éƒ¨è¡¨å¤´æ ·å¼ */
        .bottom-header-row {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%) !important;
            font-weight: bold !important;
            color: #ecf0f1 !important;
            position: sticky !important;
            bottom: 0 !important;
            z-index: 90 !important;
            border-top: 2px solid #8a2be2;
        }

        .table-footer {
            padding: 2px;
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            display: flex;
            justify-content: center;
            min-height: 16px;
            cursor: pointer;
            border-top: 1px solid #4a5f7a;
        }

        .footer-collapse-btn {
            background: none;
            border: none;
            font-size: 14px;
            color: white;
            padding: 0;
            width: 18px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .footer-collapse-btn.collapsed { transform: rotate(180deg); }
        
        .road-number {
            font-weight: 600;
            color: #ecf0f1;
            font-size: 10px;
        }

        .road-number.active { color: #7CFC00; font-weight: bold; }
        
        /* ä½ç½®ç»Ÿè®¡æ ·å¼ */
        .position-digit-0 { color: #F0FFFF; font-weight: bold; font-size: 10px; }
        .position-digit-1 { color: #FF00FF; font-weight: bold; font-size: 10px; }
        .position-digit-2 { color: #00FFFF; font-weight: bold; font-size: 10px; }
        .position-digit-3 { color: #f39c12; font-weight: bold; font-size: 10px; }
        
        /* ç»Ÿè®¡æ•°å­—æ ·å¼ */
        .digit-1 { color: #FFD700; font-weight: bold; font-size: 10px; }
        .digit-2 { color: #e74c3c; font-weight: bold; font-size: 10px; }
        
        .stat-value { font-weight: bold; font-size: 10px; color: #ecf0f1; }
        
        /* å°¾å·012è·¯æ¯”é¢œè‰²æ ·å¼ */
        .tail-road-0 { color: #3498db; font-weight: bold; }
        .tail-road-1 { color: #e74c3c; font-weight: bold; }
        .tail-road-2 { color: #2ecc71; font-weight: bold; }

        /* å°¾å·å¥‡å¶ç»Ÿè®¡é¢œè‰²æ ·å¼ */
        .tail-odd { color: #f39c12; font-weight: bold; }
        .tail-even { color: #9b59b6; font-weight: bold; }

        /* ç©ºæ•°æ®è¡Œæ ·å¼ */
        .empty-row { background-color: rgba(255, 255, 255, 0.1) !important; }
        .empty-row td { color: #bdc3c7; font-style: italic; padding: 2px; }

        /* ç­›é€‰æŒ‰é’®æ ·å¼ */
        .filter-input {
            width: 100%;
            padding: 2px;
            border: 1px solid #4a5f7a;
            border-radius: 3px;
            font-size: 12px;
            background: #1e2a3a;
            color: #7CFC00;
            text-align: center;
            height: 20px;
        }

        .filter-input::placeholder { color: #7f8c8d; font-size: 9px; }

        /* å®Œå…¨éšè—æ•°å­—è¾“å…¥æ¡†çš„ä¸Šä¸‹ç®­å¤´ */
        .filter-input[type="number"]::-webkit-outer-spin-button,
        .filter-input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .filter-input[type="number"] { -moz-appearance: textfield; padding: 2px; }

        /* ç­›é€‰æ“ä½œæŒ‰é’®åŒºåŸŸ */
        .filter-buttons {
            display: flex;
            gap: 12px;
            margin: 12px 0;
            justify-content: space-between;
            width: 100%;
            align-items: center;
        }
        
        .filter-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            font-weight: 500;
            min-width: 80px;
            flex: 1;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .filter-btn:active { transform: scale(0.98); }
        .reset-btn { background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%); }
        .generate-btn { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); }
        .calculate-btn { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }

        /* å¤åˆ¶æŒ‰é’®ä¸‹æ‹‰èœå• */
        .copy-dropdown { position: relative; display: flex; flex: 1; }
        .copy-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            font-weight: 500;
            min-width: 80px;
            width: 100%;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .copy-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #2c3e50;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            margin-top: 4px;
            overflow: hidden;
            border: 1px solid #4a5f7a;
        }

        .copy-dropdown:hover .copy-dropdown-content { display: block; }
        .copy-option {
            padding: 10px 12px;
            color: #ecf0f1;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #4a5f7a;
        }
        .copy-option:last-child { border-bottom: none; }
        .copy-option:hover { background: #3498db; }
        .copy-option .hint { font-size: 10px; color: #bdc3c7; margin-top: 2px; }

        /* ç­›é€‰ç»“æœåŒºåŸŸ */
        .filter-results {
            background: transparent;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 2px solid #8a2be2;
        }

        .filter-results h3 { font-size: 14px; margin-bottom: 8px; color: #ecf0f1; font-weight: 600; }

        /* ç­›é€‰é€‰æ‹©åŒºåŸŸ */
        .blue-ball-selection {
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(30, 42, 58, 0.8);
            border-radius: 6px;
            border: 1px solid #4a5f7a;
        }

        .blue-ball-title { font-size: 12px; margin-bottom: 8px; color: #bdc3c7; text-align: center; }
        .blue-balls { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; }
        .blue-ball {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background: linear-gradient(135deg, #3498db 0%, #1a5276 100%);
            color: white;
        }

         /* è“çƒç°è‰²çŠ¶æ€ */
       .blue-ball.excluded {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%) !important;
            border-color: #7f8c8d;
            transform: scale(0.85);
            opacity: 0.6;
       }
        .blue-ball.selected {
            border-color: #FFD700;
            box-shadow: 0 0 8px #FFD700;
            transform: scale(1.1);
        }

        .blue-ball:hover { transform: scale(1.05); }

        /* æ–°å¢çº¢çƒé€‰æ‹©åŒºåŸŸæ ·å¼ */
        .red-ball-selection {
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(30, 42, 58, 0.8);
            border-radius: 6px;
            border: 1px solid #4a5f7a;
        }

        .red-ball-title { 
            font-size: 12px; 
            margin-bottom: 8px; 
            color: #bdc3c7; 
            text-align: center; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .red-ball-controls {
            display: flex;
            gap: 8px;
        }

        .red-ball-control-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .red-ball-control-btn.clear {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .red-ball-control-btn:hover {
            background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
        }

        .red-ball-control-btn.clear:hover {
            background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%);
        }

        .red-balls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .red-ball-row {
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .red-ball {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            box-shadow: inset -2px -2px 6px rgba(0, 0, 0, 0.6), inset 2px 2px 6px rgba(255, 255, 255, 0.2), 0 3px 8px rgba(0, 0, 0, 0.4);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        /* é€‰ä¸­çš„çº¢çƒ - é«˜äº®æ•ˆæœ */
        .red-ball.selected {
            border-color: #FFD700;
            transform: scale(1.1);
        }

        /* æ’é™¤çš„çº¢çƒ - ç°è‰²æ•ˆæœ */
        .red-ball.excluded {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%) !important;
            border-color: #7f8c8d;
            transform: scale(0.85);
            opacity: 0.6;
        }

        .red-ball.excluded::after {
            position: absolute;
            top: -3px;
            right: -3px;
            background: #e74c3c;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .red-ball:hover { transform: scale(1.05); }

        .number-sets-container { flex: 1; display: flex; flex-direction: column; min-height: 0; width: 100%; }
        .number-sets {
            flex: 1;
            overflow-y: auto;
            border: none;
            border-radius: 0;
            padding: 0;
            background: transparent;
            max-height: none;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            align-content: flex-start;
        }
        
        /* å·ç ç»„å¸ƒå±€ */
        .number-set {
            display: flex;
            padding: 8px;
            background-color: #2c3e50;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            width: 100%;
            margin-bottom: 0;
            flex-shrink: 0;
            min-height: 50px;
            align-items: center;
            justify-content: flex-start;
            gap: 6px;
            box-sizing: border-box;
        }
        
        .number {
            display: inline-flex;
            width: 26px;
            height: 26px;
            line-height: 26px;
            text-align: center;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            font-weight: 600;
            font-size: 12px;
            flex-shrink: 0;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
         /* ä¿®æ”¹ç”Ÿæˆç»“æœå·ç å­—ä½“å¤§å° */
         #numberSets .number {
                   font-size: 12px !important;
       }

        .number.small { background-color: #3498db; }
        .number.large { background-color: #e74c3c; }
        .number.even { background-color: #2ecc71; }
        .number.odd { background-color: #f39c12; }
        .number.blue {
            background: linear-gradient(135deg, #3498db 0%, #1a5276 100%);
            margin-left: 8px;
            border: 2px solid #FFD700;
        }

        .calculation-result {
            margin-top: 10px;
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 12px;
            width: 100%;
        }
        
        .calculation-result.safe { background-color: rgba(46, 204, 113, 0.2); border-left: 3px solid #2ecc71; }
        .calculation-result.warning { background-color: rgba(243, 156, 18, 0.2); border-left: 3px solid #f39c12; }
        .calculation-result.danger { background-color: rgba(231, 76, 60, 0.2); border-left: 3px solid #e74c3c; }
        .calculation-details { margin-top: 4px; font-size: 10px; color: #bdc3c7; }
        .loading { text-align: center; padding: 16px; color: #bdc3c7; font-size: 12px; }
        
        /* è¡¨æ ¼è¡Œæ ·å¼ */
#roadTable tbody tr {
    transition: background-color 0.2s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
}

#roadTable tbody tr:nth-child(even) { 
    background-color: rgba(255, 255, 255, 0.05); 
}

#roadTable tbody tr:nth-child(odd) { 
    background-color: rgba(255, 255, 255, 0.02); 
}

#roadTable tbody tr:hover { 
    background-color: rgba(52, 152, 219, 0.1); 
}

/* è¡Œæ‚¬åœæ•ˆæœ */
        tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        /* åå­—æ¶é«˜äº®æ•ˆæœ */
        .cross-highlight {
            background-color: rgba(70, 130, 180, 0.6) !important;
        }
        
        .row-highlight {
            background-color: rgba(70, 130, 180, 0.6) !important;
        }
        
        .col-highlight {
            background-color: rgba(70, 130, 180, 0.6) !important;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .number-sets { grid-template-columns: 1fr 1fr; gap: 8px; }
            .number-set { padding: 6px; min-height: 45px; gap: 4px; }
            .number { width: 24px; height: 24px; font-size: 11px; }
            .header { padding: 12px 15px; }
            .header-title { font-size: 18px; }
            .excel-import-btn { padding: 10px 16px; font-size: 12px; min-width: 120px; }
            .ball-3d { width: 18px; height: 18px; font-size: 9px; }
            #blueTable th, #blueTable td { font-size: 11px !important; }
            #roadTable th, #roadTable td { font-size: 14px !important; }
            .ball-3d { font-size: 10px !important; }
            #blueTable thead tr:nth-child(2) th { top: 24px; }
            #roadTable thead tr:nth-child(2) th { top: 24px; }
            .filter-input { font-size: 14px; height: 18px; }
            .filter-btn { padding: 6px 12px; font-size: 16px; min-width: 70px; }
            .blue-ball { width: 24px; height: 24px; font-size: 10px; }
            .filter-buttons { gap: 8px; }
            .filter-btn, .copy-btn { padding: 10px 12px; font-size: 14px; min-width: 70px; height: 40px; }
            .date-display { min-width: 100px; }
            .current-date { font-size: 14px; padding: 6px 0; }
            .balls-grid { row-gap: 20px !important; column-gap: 6px; }
            .kill-ball { width: 28px; height: 28px; font-size: 12px; }
            .result-number { width: 40px; height: 40px; font-size: 16px; }
            .filter-controls { margin-top: 15px; }
            .reset-btn { padding: 8px 16px; font-size: 13px; }
            .kill-text { font-size: 12px; }
            .filter-btn { padding: 8px 6px; font-size: 15px; }
            
            /* ç§»åŠ¨ç«¯çº¢çƒé€‰æ‹©åŒºåŸŸé€‚é… */
            .red-balls-grid {
                grid-template-columns: 1fr;
                gap: 6px;
            }
            
            .red-ball-row {
                justify-content: space-around;
            }
            
            .red-ball {
                width: 26px;
                height: 26px;
                font-size: 11px;
            }
        }

        /* è¶…å°å±å¹•é€‚é… */
        @media (max-width: 480px) {
            .number-sets { grid-template-columns: 1fr 1fr; gap: 6px; }
            .number-set { padding: 4px; min-height: 40px; gap: 3px; }
            .number { width: 22px; height: 22px; font-size: 10px; }
            
            /* è¶…å°å±å¹•çº¢çƒé€‰æ‹©åŒºåŸŸé€‚é… */
            .red-ball {
                width: 24px;
                height: 24px;
                font-size: 10px;
            }
            
            .red-ball-control-btn {
                padding: 3px 6px;
                font-size: 9px;
            }
        }

        /* è®°å½•åˆ—ç‰¹æ®Šæ ·å¼ */
        .record-cell {
            background-color: rgba(255, 215, 0, 0.2);
            font-weight: bold;
            color: #FFD700;
            border: 1px solid #FFD700 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ¬å¤´+å¯¼å…¥excelåŠŸèƒ½ -->
        <div class="header">
            <div class="header-title">åŒè‰²çƒç»¼åˆåˆ†æç³»ç»Ÿ</div>
            <button class="excel-import-btn" id="excelImportBtn">å¯¼å…¥Excel</button>
        </div>
        
        <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šå¹´ä»½+æœŸæ•°+æ˜ŸæœŸåŠŸèƒ½ -->
        <div class="filter-section">
            <div class="filter-item">
                <div class="filter-label vertical">å¹´ä»½</div>
                <select id="year"><option value="all">å…¨éƒ¨</option></select>
            </div>
            <div class="filter-item">
                <div class="filter-label vertical">æœŸæ•°</div>
                <select id="period">
                    <option selected>10æœŸ</option>
                    <option>30æœŸ</option>
                    <option>50æœŸ</option>
                    <option>100æœŸ</option>
                    <option>200æœŸ</option>
                    <option>å…¨éƒ¨æ•°æ®</option>
                </select>
            </div>
            <div class="filter-item">
                <div class="filter-label vertical">æ˜ŸæœŸ</div>
                <select id="weekday">
                    <option value="all" selected>å…¨éƒ¨</option>
                    <option value="äºŒ">äºŒ</option>
                    <option value="å››">å››</option>
                    <option value="æ—¥">æ—¥</option>
                </select>
            </div>
        </div>

        <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šè“çƒèµ°åŠ¿åˆ†æåŒº -->
        <div class="data-section">
            <div class="section-title" id="blueTitle">
                <span>è“çƒ > èµ°åŠ¿åˆ†æåŒº</span>
                <div class="collapse-btn">â–¶</div>
            </div>
            <div class="table-container collapsed" id="blueTableContainer">
                <table id="blueTable" class="data-table">
                    <thead>
                        <tr>
                            <th colspan="3" class="group-header">åŸºç¡€ä¿¡æ¯</th>
                            <th colspan="2" class="group-header">å¤§å°åŒº</th>
                            <th colspan="2" class="group-header">å¥‡å¶åŒº</th>
                            <th colspan="3" class="group-header">012è·¯åŒº</th>
                            <th colspan="3" class="group-header">012ç»Ÿè®¡</th>
                            <th colspan="8" class="group-header">ä¸€åŒºè“çƒ</th>
                            <th colspan="8" class="group-header">äºŒåŒºè“çƒ</th>
                        </tr>
                        <tr>
                            <th>æœŸå·</th>
                            <th>æ˜ŸæœŸ</th>
                            <th class="col-group-1">è“çƒ</th>
                            <th>å¤§</th>
                            <th class="col-group-2">å°</th>
                            <th>å¥‡</th>
                            <th class="col-group-3">å¶</th>
                            <th>0</th>
                            <th>1</th>
                            <th class="col-group-4">2</th>
                            <th>0</th>
                            <th>1</th>
                            <th class="col-group-5">2</th>
                            <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th>
                            <th class="col-group-6">8</th>
                            <th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th>
                        </tr>
                    </thead>
                    <tbody id="blueTableBody"></tbody>
                </table>
                <div id="zoneTrendLinesContainer"></div>
            </div>
            <div class="table-footer" id="blueFooter">
                <div class="footer-collapse-btn collapsed">ï¸½</div>
            </div>
        </div>

        <!-- ç¬¬å››éƒ¨åˆ†ï¼šè“çƒè¿‡æ»¤åˆ†æåŒº -->
        <div class="data-section">
            <div class="section-title" id="filterTitle">
                <span>è“çƒ > è¿‡æ»¤åˆ†æåŒº</span>
                <div class="collapse-btn">â–¶</div>
            </div>
            <div class="table-container collapsed" id="filterTableContainer">
                <div class="filter-panel" id="blueFilterPanel">
                    <div class="filter-section-inner">
                        <div class="filter-options">
                            <div class="filter-btn small" data-filter="small">å°æ•° (1-8)</div>
                            <div class="filter-btn big" data-filter="big">å¤§æ•° (9-16)</div>
                        </div>
                    </div>
                    <div class="filter-section-inner">
                        <div class="filter-options">
                            <div class="filter-btn odd" data-filter="odd">å¥‡ æ•°</div>
                            <div class="filter-btn even" data-filter="even">å¶ æ•°</div>
                        </div>
                    </div>
                    <div class="filter-section-inner">
                        <div class="road-options">
                            <div class="filter-btn road0" data-filter="road0">0 è·¯</div>
                            <div class="filter-btn road1" data-filter="road1">1 è·¯</div>
                            <div class="filter-btn road2" data-filter="road2">2 è·¯</div>
                        </div>
                    </div>
                    <div class="filter-section-inner">
                        <div class="filter-title">æ€ç æ’é™¤ ç‚¹å‡»çƒä½“æ’é™¤å·ç </div>
                        <div class="balls-grid" id="kill-balls"></div>
                    </div>
                    <div class="filter-controls">
                        <div class="kill-text"></div>
                        <button class="reset-btn" id="reset-filter-btn">é‡ç½®æ¡ä»¶</button>
                    </div>
                </div>

                <div class="filter-result" id="filterResult">
                    <div class="result-title">ğŸ¯ æ¨ç®—ç»“æœ</div>
                    <div class="result-numbers" id="result-numbers">
                        <div class="no-result">è¯·é€‰æ‹©ç­›é€‰æ¡ä»¶</div>
                    </div>
                </div>
            </div>
            <div class="table-footer" id="filterFooter">
                <div class="footer-collapse-btn collapsed">ï¸½</div>
            </div>
        </div>

        <!-- ç¬¬äº”éƒ¨åˆ†ï¼šçº¢çƒç­›é€‰åŠŸèƒ½åŒº -->
        <div class="data-section">
            <div class="section-title" id="roadTitle">
                <span>çº¢çƒ > ç­›é€‰åˆ†æåŒº</span>
                <div class="filter-item date-display">
                    <div class="current-date" id="currentDate"></div>
                </div>  
                <div class="collapse-btn">â–¶</div>
            </div>
            <div class="table-container collapsed" id="roadTableContainer">
                <table id="roadTable" class="data-table">
                    <thead>
                        <tr>
                            <th colspan="2" class="group-header">åŸºç¡€ä¿¡æ¯</th>
                            <th colspan="7" class="group-header">çº¢çƒ1-6+è“çƒ</th>
                            <th colspan="6" class="group-header">ç»Ÿè®¡çº¢çƒä½æ•°</th>
                            <th colspan="6" class="group-header">ä½ç½®ç»Ÿè®¡çº¢çƒ</th>
                            <th colspan="6" class="group-header">å°¾å·012è·¯æ¯”</th>
                            <th colspan="6" class="group-header">å°¾å·å¥‡å¶ç»Ÿè®¡</th>
                            <th colspan="3" class="group-header">012è·¯é™¤3</th>
                            <th colspan="3" class="group-header">åŒºé—´ç»Ÿè®¡</th>
                            <th colspan="2" class="group-header">å¥‡å¶æ¯”</th>
                            <th colspan="2" class="group-header">è´¨åˆæ¯”</th>
                            <th colspan="2" class="group-header">å¤§å°æ¯”</th>
                            <th colspan="4" class="group-header">å‚æ•°ä¿¡æ¯</th>
                        </tr>
                        <tr>
                            <!-- åŸºç¡€ä¿¡æ¯ -->
                            <th>æœŸå·</th>
                            <th>æ˜ŸæœŸ</th>
                            
                            <!-- çº¢çƒ1-6+è“çƒ -->
                            <th>çº¢1</th>
                            <th>çº¢2</th>
                            <th>çº¢3</th>
                            <th>çº¢4</th>
                            <th>çº¢5</th>
                            <th>çº¢6</th>
                            <th>è“çƒ</th>
                            
                            <!-- ç»Ÿè®¡çº¢çƒä½æ•° -->
                            <th>1ä½</th>
                            <th>2ä½</th>
                            <th>3ä½</th>
                            <th>4ä½</th>
                            <th>5ä½</th>
                            <th>6ä½</th>
                            
                            <!-- ä½ç½®ç»Ÿè®¡çº¢çƒ -->
                            <th>ç½®1</th>
                            <th>ç½®2</th>
                            <th>ç½®3</th>
                            <th>ç½®4</th>
                            <th>ç½®5</th>
                            <th>ç½®6</th>
                            
                            <!-- å°¾å·012è·¯æ¯” -->
                            <th>å°¾1</th>
                            <th>å°¾2</th>
                            <th>å°¾3</th>
                            <th>å°¾4</th>
                            <th>å°¾5</th>
                            <th>å°¾6</th>
                            
                            <!-- å°¾å·å¥‡å¶ç»Ÿè®¡ -->
                            <th>è®¡1</th>
                            <th>è®¡2</th>
                            <th>è®¡3</th>
                            <th>è®¡4</th>
                            <th>è®¡5</th>
                            <th>è®¡6</th>

                            <!-- 012è·¯æ¯” -->
                            <th>0è·¯</th>
                            <th>1è·¯</th>
                            <th>2è·¯</th>
                            
                            <!-- åŒºé—´ç»Ÿè®¡ -->
                            <th>ä¸€åŒº</th>
                            <th>äºŒåŒº</th>
                            <th>ä¸‰åŒº</th>
                            
                            <!-- å¥‡å¶æ¯” -->
                            <th>å¥‡æ•°</th>
                            <th>å¶æ•°</th>
                            
                            <!-- è´¨åˆæ¯” -->
                            <th>è´¨æ•°</th>
                            <th>åˆæ•°</th>
                            
                            <!-- å¤§å°æ¯” -->
                            <th>å°æ•°</th>
                            <th>å¤§æ•°</th>
                            
                            <!-- å‚æ•°ä¿¡æ¯ -->
                            <th>å’Œå€¼</th>
                            <th>è·¨åº¦</th>
                            <th>ACå€¼</th>
                            <th>è®°å½•</th>
                        </tr>
                    </thead>
                    <tbody id="roadTableBody"></tbody>
                </table>
            </div>
            <div class="table-footer" id="roadFooter">
                <div class="footer-collapse-btn collapsed">ï¸½</div>
            </div>
        </div>

        <!-- ç­›é€‰æ“ä½œæŒ‰é’®åŒºåŸŸ -->
        <div class="filter-buttons">
            <button type="button" id="calculateButton" class="filter-btn calculate-btn">è®¡ç®—ç»„æ•°</button>
            <button type="button" id="generateButton" class="filter-btn generate-btn">ç”Ÿæˆå·ç </button>
            <button type="button" id="resetButton" class="filter-btn reset-btn">é‡ç½®</button>
            <div class="copy-dropdown">
                <button class="copy-btn">å¤åˆ¶ â–¼</button>
                <div class="copy-dropdown-content">
                    <div class="copy-option" onclick="copyFormatted()">æ ¼å¼å¤åˆ¶</div>
                    <div class="copy-option" onclick="copyWithNumbers()">æ•°é‡å¤åˆ¶</div>
                </div>
            </div>
        </div>

        <!-- æ–°å¢çº¢çƒé€‰æ‹©åŒºåŸŸ -->
        <div class="red-ball-selection">
            <div class="red-ball-title">
                <span>çº¢çƒæ€å·æ’é™¤ ç‚¹å‡»çƒä½“æ’é™¤å·ç </span>
                <div class="red-ball-controls">
                    <button class="red-ball-control-btn" id="selectAllRed">å…¨é€‰</button>
                    <button class="red-ball-control-btn clear" id="clearAllRed">æ¸…ç©º</button>
                </div>
            </div>
            <div class="red-balls-grid" id="redBallsGrid">
                <!-- ä¸‰è¡Œæ’åˆ—çš„çº¢çƒ -->
                <div class="red-ball-row" id="redRow1"></div>
                <div class="red-ball-row" id="redRow2"></div>
                <div class="red-ball-row" id="redRow3"></div>
            </div>
        </div>

        <!-- è“çƒé€‰æ‹©åŒºåŸŸ -->
        <div class="blue-ball-selection">
            <div class="blue-ball-title">è“çƒæ€å·æ’é™¤ ç‚¹å‡»çƒä½“æ’é™¤å·ç </div>
            <div class="blue-balls" id="blueBalls"></div>
        </div>

        <div id="calculationResult" class="calculation-result" style="display: none;"></div>
        <div class="number-sets-container">
            <div class="number-sets" id="numberSets">
                <p style="text-align: center; color: #bdc3c7; grid-column: 1 / -1;">è¯·å…ˆè®¾ç½®æ¡ä»¶å¹¶è®¡ç®—ç»„æ•°</p>
            </div>
        </div>
    </div>

    <script>
        // æ€§èƒ½ä¼˜åŒ–é…ç½®
        const PERFORMANCE_CONFIG = {
            MAX_ROWS: 500,
            DEBOUNCE_DELAY: 50,
            ANIMATION_DURATION: 300
        };

        // æ•°æ®å­˜å‚¨
        const allLotteryData = [];
        const allRoadData = [];
        let selectedBlueBalls = [];
        let excludedBlueBalls = [];
        let selectedRedBalls = []; // é€‰ä¸­çš„çº¢çƒï¼ˆå‚ä¸åˆ†æï¼‰
        let excludedRedBalls = []; // æ’é™¤çš„çº¢çƒï¼ˆæ€å·ï¼‰
        let calculatedCount = 0;

        // LocalStorage é”®å
        const STORAGE_KEYS = {
            LOTTERY_DATA: 'lotteryData',
            ROAD_DATA: 'roadData',
            SELECTED_BLUE_BALLS: 'selectedBlueBalls',
            EXCLUDED_BLUE_BALLS: 'excludedBlueBalls',
            SELECTED_RED_BALLS: 'selectedRedBalls',
            EXCLUDED_RED_BALLS: 'excludedRedBalls',
            FILTER_CONDITIONS: 'filterConditions',
            ACTIVE_CONDITIONS: 'activeConditions'
        };

        // è¿‡æ»¤åˆ†æç›¸å…³å˜é‡
        let activeConditions = [];

        // åˆå§‹åŒ–çº¢çƒé€‰æ‹©
        function initializeRedBalls() {
            const redRow1 = document.getElementById('redRow1');
            const redRow2 = document.getElementById('redRow2');
            const redRow3 = document.getElementById('redRow3');
            
            redRow1.innerHTML = '';
            redRow2.innerHTML = '';
            redRow3.innerHTML = '';
            
            // æŒ‰ç…§ä¸ªä½æ•°é™¤3ä½™æ•°åˆ†ç»„æ’åˆ—
    const row1Numbers = [1, 4, 7, 11, 14, 17, 21, 24, 27, 31, 33]; // ä¸ªä½é™¤3ä½™1
    const row2Numbers = [2, 5, 8, 12, 15, 18, 22, 25, 28, 32, 30]; // ä¸ªä½é™¤3ä½™2
    const row3Numbers = [3, 6, 9, 10, 13, 16, 19, 20, 23, 26, 29]; // ä¸ªä½é™¤3ä½™0
    
    // åˆ›å»ºç¬¬ä¸€è¡Œçº¢çƒï¼ˆä½™1ï¼‰
    row1Numbers.forEach(number => {
        createRedBallElement(number, redRow1);
    });
    
    // åˆ›å»ºç¬¬äºŒè¡Œçº¢çƒï¼ˆä½™2ï¼‰
    row2Numbers.forEach(number => {
        createRedBallElement(number, redRow2);
    });
    
    // åˆ›å»ºç¬¬ä¸‰è¡Œçº¢çƒï¼ˆä½™0ï¼‰
    row3Numbers.forEach(number => {
        createRedBallElement(number, redRow3);
    });
    
    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½çº¢çƒçŠ¶æ€
    loadRedBallState();
    
    // ç»‘å®šå…¨é€‰å’Œæ¸…ç©ºæŒ‰é’®äº‹ä»¶
    document.getElementById('selectAllRed').addEventListener('click', selectAllRedBalls);
    document.getElementById('clearAllRed').addEventListener('click', clearAllRedBalls);
}

        // åˆ›å»ºçº¢çƒå…ƒç´ 
function createRedBallElement(number, container) {
    const redBall = document.createElement('div');
    redBall.className = 'red-ball';
    redBall.textContent = number;
    redBall.dataset.number = number;
    
    redBall.addEventListener('click', function() {
        const number = parseInt(this.dataset.number);
        
        if (this.classList.contains('excluded')) {
            // æ’é™¤çŠ¶æ€ â†’ ç‚¹å‡» â†’ é«˜äº®çŠ¶æ€
            this.classList.remove('excluded');
            this.classList.add('selected');
            excludedRedBalls = excludedRedBalls.filter(n => n !== number);
            selectedRedBalls.push(number);
        } else {
            // é«˜äº®çŠ¶æ€ â†’ ç‚¹å‡» â†’ æ’é™¤çŠ¶æ€
            this.classList.remove('selected');
            this.classList.add('excluded');
            selectedRedBalls = selectedRedBalls.filter(n => n !== number);
            excludedRedBalls.push(number);
        }
        
        saveRedBallState();
    });
    
    container.appendChild(redBall);
}

        // åŠ è½½çº¢çƒçŠ¶æ€
        function loadRedBallState() {
            const savedSelected = localStorage.getItem(STORAGE_KEYS.SELECTED_RED_BALLS);
            const savedExcluded = localStorage.getItem(STORAGE_KEYS.EXCLUDED_RED_BALLS);
            
            if (savedSelected) {
                selectedRedBalls = JSON.parse(savedSelected);
            }
            if (savedExcluded) {
                excludedRedBalls = JSON.parse(savedExcluded);
            }
            
            // å…³é”®ä¿®æ”¹ï¼šå¦‚æœæ²¡æœ‰ä¿å­˜çš„çŠ¶æ€ï¼Œä½¿ç”¨è¡¥å…¨å·ç é€»è¾‘
            if (!savedSelected && !savedExcluded) {
                resetRedBallsToTailCompletion();
                return;
            }
            
            // åº”ç”¨ä¿å­˜çš„çŠ¶æ€
            updateRedBallUI();
        }

        // æ–°å¢å‡½æ•°ï¼šé‡ç½®çº¢çƒä¸ºè¡¥å…¨å·ç 
        function resetRedBallsToTailCompletion() {
            // è·å–æœ€æ–°ä¸€æœŸæ•°æ®
            if (allRoadData.length > 0) {
                const latestData = allRoadData[allRoadData.length - 1];
                const currentRedBalls = latestData.redBalls;
                
                // è®¡ç®—å°¾å·è¡¥å…¨å·ç 
                const tailCompletionNumbers = calculateTailCompletionNumbers(currentRedBalls);
                
                // è®¾ç½®çº¢çƒçŠ¶æ€
                selectedRedBalls = [...tailCompletionNumbers];
                excludedRedBalls = Array.from({length: 33}, (_, i) => i + 1)
                    .filter(num => !tailCompletionNumbers.includes(num));
                
                console.log(`é‡ç½®çº¢çƒ - å½“å‰æœŸå·ç : ${currentRedBalls.join(',')}`);
                console.log(`é‡ç½®çº¢çƒ - è¡¥å…¨å·ç : ${tailCompletionNumbers.join(',')}`);
                console.log(`é‡ç½®çº¢çƒ - é€‰ä¸­æ•°é‡: ${selectedRedBalls.length}, æ’é™¤æ•°é‡: ${excludedRedBalls.length}`);
                
                // æ›´æ–°UI
                updateRedBallUI();
                saveRedBallState();
            } else {
                // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œé»˜è®¤å…¨é€‰
                selectAllRedBalls();
            }
        }

        // æ›´æ–°çº¢çƒUIæ˜¾ç¤º
        function updateRedBallUI() {
            document.querySelectorAll('.red-ball').forEach(ball => {
                const number = parseInt(ball.dataset.number);
                ball.classList.remove('selected', 'excluded');
                
                if (excludedRedBalls.includes(number)) {
                    ball.classList.add('excluded');
                } else {
                    ball.classList.add('selected');
                }
            });
        }

        // ä¿å­˜çº¢çƒçŠ¶æ€
        function saveRedBallState() {
            localStorage.setItem(STORAGE_KEYS.SELECTED_RED_BALLS, JSON.stringify(selectedRedBalls));
            localStorage.setItem(STORAGE_KEYS.EXCLUDED_RED_BALLS, JSON.stringify(excludedRedBalls));
        }

        // å…¨é€‰çº¢çƒ
        function selectAllRedBalls() {
            selectedRedBalls = Array.from({length: 33}, (_, i) => i + 1);
            excludedRedBalls = [];
            
            document.querySelectorAll('.red-ball').forEach(ball => {
                ball.classList.remove('excluded');
                ball.classList.add('selected');
            });
            
            saveRedBallState();
        }

        // æ¸…ç©ºçº¢çƒï¼ˆå…¨éƒ¨æ’é™¤ï¼‰
        function clearAllRedBalls() {
            selectedRedBalls = [];
            excludedRedBalls = Array.from({length: 33}, (_, i) => i + 1);
            
            document.querySelectorAll('.red-ball').forEach(ball => {
                ball.classList.remove('selected');
                ball.classList.add('excluded');
            });
            
            saveRedBallState();
        }

        // åˆå§‹åŒ–è“çƒé€‰æ‹©
function initializeBlueBalls() {
    const blueBallsContainer = document.getElementById('blueBalls');
    blueBallsContainer.innerHTML = '';
    
    for (let i = 1; i <= 16; i++) {
        const blueBall = document.createElement('div');
        blueBall.className = 'blue-ball excluded'; // é»˜è®¤æ·»åŠ excludedç±»
        blueBall.textContent = i;
        blueBall.dataset.number = i;
        
        blueBall.addEventListener('click', function() {
            const number = parseInt(this.dataset.number);
            
            if (this.classList.contains('excluded')) {
                // ç°è‰²çŠ¶æ€ â†’ ç‚¹å‡» â†’ é»„åœˆçŠ¶æ€ï¼ˆå‚ä¸ï¼‰
                this.classList.remove('excluded');
                this.classList.add('selected');
                if (!selectedBlueBalls.includes(number)) {
                    selectedBlueBalls.push(number);
                }
            } else {
                // é»„åœˆçŠ¶æ€ â†’ ç‚¹å‡» â†’ ç°è‰²çŠ¶æ€ï¼ˆä¸å‚ä¸ï¼‰
                this.classList.remove('selected');
                this.classList.add('excluded');
                selectedBlueBalls = selectedBlueBalls.filter(n => n !== number);
            }
            
            localStorage.setItem(STORAGE_KEYS.SELECTED_BLUE_BALLS, JSON.stringify(selectedBlueBalls));
        });
        
        blueBallsContainer.appendChild(blueBall);
    }
    
    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å·²é€‰ä¸­çš„è“çƒ
    const savedBlueBalls = localStorage.getItem(STORAGE_KEYS.SELECTED_BLUE_BALLS);
    if (savedBlueBalls) {
        selectedBlueBalls = JSON.parse(savedBlueBalls);
        selectedBlueBalls.forEach(number => {
            const ballElement = blueBallsContainer.querySelector(`[data-number="${number}"]`);
            if (ballElement) {
                ballElement.classList.remove('excluded');
                ballElement.classList.add('selected');
            }
        });
    }
    // é»˜è®¤æ‰€æœ‰è“çƒéƒ½æ˜¯ç°è‰²ä¸å‚ä¸çŠ¶æ€
}

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ä¿å­˜æ•°æ®åˆ°LocalStorage
        function saveDataToLocalStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.LOTTERY_DATA, JSON.stringify(allLotteryData));
                localStorage.setItem(STORAGE_KEYS.ROAD_DATA, JSON.stringify(allRoadData));
            } catch (e) {
                console.warn('æœ¬åœ°å­˜å‚¨ä¿å­˜å¤±è´¥:', e);
            }
        }

        // ä»LocalStorageåŠ è½½æ•°æ®
        function loadDataFromLocalStorage() {
            try {
                const savedLotteryData = localStorage.getItem(STORAGE_KEYS.LOTTERY_DATA);
                const savedRoadData = localStorage.getItem(STORAGE_KEYS.ROAD_DATA);
                
                if (savedLotteryData) {
                    const parsedData = JSON.parse(savedLotteryData);
                    allLotteryData.length = 0;
                    allLotteryData.push(...parsedData);
                }
                
                if (savedRoadData) {
                    const parsedData = JSON.parse(savedRoadData);
                    allRoadData.length = 0;
                    allRoadData.push(...parsedData);
                }
                
                return allLotteryData.length > 0;
            } catch (e) {
                console.warn('æœ¬åœ°å­˜å‚¨è¯»å–å¤±è´¥:', e);
                return false;
            }
        }

        // ä¿å­˜ç­›é€‰æ¡ä»¶åˆ°LocalStorage
        function saveFilterConditions() {
            try {
                const conditions = getFilterConditions();
                localStorage.setItem(STORAGE_KEYS.FILTER_CONDITIONS, JSON.stringify(conditions));
            } catch (e) {
                console.warn('ç­›é€‰æ¡ä»¶ä¿å­˜å¤±è´¥:', e);
            }
        }

        // ä»LocalStorageåŠ è½½ç­›é€‰æ¡ä»¶
        function loadFilterConditions() {
            try {
                const savedConditions = localStorage.getItem(STORAGE_KEYS.FILTER_CONDITIONS);
                if (savedConditions) {
                    const conditions = JSON.parse(savedConditions);
                    setFilterConditions(conditions);
                }
            } catch (e) {
                console.warn('ç­›é€‰æ¡ä»¶åŠ è½½å¤±è´¥:', e);
            }
        }

        // è®¾ç½®ç­›é€‰æ¡ä»¶åˆ°è¾“å…¥æ¡†
        function setFilterConditions(conditions) {
            // å‚æ•°ä¿¡æ¯
            document.getElementById('sumValue').value = conditions.sumValue || '';
            document.getElementById('spanValue').value = conditions.spanValue || '';
            document.getElementById('acValue').value = conditions.acValue || '';
            
            // åŒºé—´ç»Ÿè®¡
            document.getElementById('zone1').value = conditions.zone1 || '';
            document.getElementById('zone2').value = conditions.zone2 || '';
            document.getElementById('zone3').value = conditions.zone3 || '';
            
            // å¥‡å¶æ¯”
            document.getElementById('oddCount').value = conditions.oddCount || '';
            document.getElementById('evenCount').value = conditions.evenCount || '';
            
            // å¤§å°æ¯”
            document.getElementById('smallCount').value = conditions.smallCount || '';
            document.getElementById('largeCount').value = conditions.largeCount || '';
            
            // è´¨åˆæ¯”
            document.getElementById('primeCount').value = conditions.primeCount || '';
            document.getElementById('compositeCount').value = conditions.compositeCount || '';
            
            // 012è·¯æ¯”
            document.getElementById('road0').value = conditions.road0 || '';
            document.getElementById('road1').value = conditions.road1 || '';
            document.getElementById('road2').value = conditions.road2 || '';
            
            // ä½æ•°ç»Ÿè®¡æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`digit${i}`).value = conditions[`digit${i}`] || '';
            }
            
            // ä½ç½®ç»Ÿè®¡æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`position${i}`).value = conditions[`position${i}`] || '';
            }
            
            // å°¾å·012è·¯æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`tailRoad${i}`).value = conditions[`tailRoad${i}`] || '';
            }
            
            // å°¾å·å¥‡å¶æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`tailOddEven${i}`).value = conditions[`tailOddEven${i}`] || '';
            }
        }

        // æ›´æ–°å¯¼å…¥æŒ‰é’®çŠ¶æ€
        function updateImportButton() {
            const importBtn = document.getElementById('excelImportBtn');
            const totalCount = allLotteryData.length;
            
            if (totalCount > 0) {
                importBtn.textContent = `æ›´æ–° ${totalCount} æ¡`;
                importBtn.classList.add('success');
            } else {
                importBtn.textContent = 'å¯¼å…¥Excel';
                importBtn.classList.remove('success');
            }
        }

        // è·å–ä½æ•°ï¼ˆ1ä½æˆ–2ä½ï¼‰
        function getDigitCount(number) {
            return number < 10 ? 1 : 2;
        }

        // è·å–ä½ç½®ç»Ÿè®¡æ•°å­—ï¼ˆå¼€å¤´æ•°å­—ï¼‰
        function getPositionDigit(ballNumber) {
            if (ballNumber >= 1 && ballNumber <= 9) return 0;
            if (ballNumber >= 10 && ballNumber <= 19) return 1;
            if (ballNumber >= 20 && ballNumber <= 29) return 2;
            if (ballNumber >= 30 && ballNumber <= 33) return 3;
            return 0;
        }

        // è®¡ç®—å°¾å·è¡¥å…¨å·ç 
        function calculateTailCompletionNumbers(redBalls) {
            const tailCompletionSet = new Set();
            
            redBalls.forEach(ball => {
                const tailDigit = ball % 10; // è·å–å°¾å·
                // è¡¥å…¨æ‰€æœ‰å¯èƒ½çš„å·ç 
                for (let i = tailDigit; i <= 33; i += 10) {
                    if (i >= 1 && i <= 33) {
                        tailCompletionSet.add(i);
                    }
                }
            });
            
            return Array.from(tailCompletionSet);
        }

        // è®¡ç®—è®°å½•æ•°å­—
        function calculateRecordNumber(currentRedBalls, previousRedBalls) {
            if (!previousRedBalls || previousRedBalls.length === 0) {
                return 0;
            }
            
            const previousTailCompletion = calculateTailCompletionNumbers(previousRedBalls);
            const intersection = currentRedBalls.filter(ball => previousTailCompletion.includes(ball));
            
            return intersection.length;
        }

        // è®¡ç®—ç»Ÿè®¡å‚æ•°
        function calculateStatistics(redBalls) {
            const sum = redBalls.reduce((a, b) => a + b, 0);
            const span = Math.max(...redBalls) - Math.min(...redBalls);
            const acValue = calculateACValue(redBalls);
            
            // åŸæœ‰çš„é™¤3è·¯è®¡ç®—
            const road0 = redBalls.filter(n => n % 3 === 0).length;
            const road1 = redBalls.filter(n => n % 3 === 1).length;
            const road2 = redBalls.filter(n => n % 3 === 2).length;
            
            const zone1 = redBalls.filter(n => n >= 1 && n <= 11).length;
            const zone2 = redBalls.filter(n => n >= 12 && n <= 22).length;
            const zone3 = redBalls.filter(n => n >= 23 && n <= 33).length;
            const odd = redBalls.filter(n => n % 2 === 1).length;
            const even = redBalls.filter(n => n % 2 === 0).length;
            const prime = redBalls.filter(isPrime).length;
            const composite = 6 - prime;
            const small = redBalls.filter(n => n <= 16).length;
            const big = redBalls.filter(n => n >= 17).length;
            
            // æ–°å¢ï¼šå°¾å·012è·¯æ¯”ï¼ˆæ¯ä¸ªçº¢çƒçš„å°¾å·é™¤3ä½™æ•°ï¼‰
            const tail012Roads = redBalls.map(ball => (ball % 10) % 3);
            
            // æ–°å¢ï¼šå°¾å·å¥‡å¶ç»Ÿè®¡ï¼ˆæ¯ä¸ªçº¢çƒå°¾å·çš„å¥‡å¶æ€§ï¼‰
            const tailOddEven = redBalls.map(ball => (ball % 10) % 2 === 1 ? 'å¥‡' : 'å¶');
            
            return {
                sum, span, acValue,
                road0, road1, road2,
                zone1, zone2, zone3,
                odd, even,
                prime, composite,
                small, big,
                tail012Roads,    // å°¾å·012è·¯æ¯”
                tailOddEven      // å°¾å·å¥‡å¶ç»Ÿè®¡
            };
        }

        // åˆ¤æ–­è´¨æ•°
        function isPrime(num) {
            if (num <= 1) return false;
            if (num === 2) return true;
            if (num % 2 === 0) return false;
            for (let i = 3; i <= Math.sqrt(num); i += 2) {
                if (num % i === 0) return false;
            }
            return true;
        }

        // è®¡ç®—ACå€¼
        function calculateACValue(redBalls) {
            const diffs = new Set();
            for (let i = 0; i < redBalls.length; i++) {
                for (let j = i + 1; j < redBalls.length; j++) {
                    diffs.add(Math.abs(redBalls[i] - redBalls[j]));
                }
            }
            return diffs.size - (6 - 1);
        }

        // åˆ›å»ºç©ºæ•°æ®è¡Œï¼ˆå¸¦ç­›é€‰è¾“å…¥æ¡†ï¼‰
        function createEmptyRow() {
            const emptyRow = document.createElement('tr');
            emptyRow.className = 'empty-row';
            
            let html = `
                <td>--</td>
                <td>--</td>
            `;
            
            // çº¢çƒå’Œè“çƒ - ç©ºå•å…ƒæ ¼
            for (let i = 0; i < 7; i++) {
                html += `<td>--</td>`;
            }
            
            // ç»Ÿè®¡çº¢çƒä½æ•° - ç­›é€‰è¾“å…¥æ¡†
            for (let i = 1; i <= 6; i++) {
                html += `<td><input type="number" class="filter-input" id="digit${i}" placeholder="ä½${i}" min="1" max="2"></td>`;
            }
            
            // ä½ç½®ç»Ÿè®¡çº¢çƒ - ç­›é€‰è¾“å…¥æ¡†
            for (let i = 1; i <= 6; i++) {
                html += `<td><input type="number" class="filter-input" id="position${i}" placeholder="ç½®${i}" min="0" max="3"></td>`;
            }
            
            // å°¾å·012è·¯æ¯” - ç­›é€‰è¾“å…¥æ¡†
            for (let i = 1; i <= 6; i++) {
                html += `<td><input type="number" class="filter-input" id="tailRoad${i}" placeholder="å°¾${i}" min="0" max="2"></td>`;
            }
            
            // å°¾å·å¥‡å¶ç»Ÿè®¡ - ç­›é€‰è¾“å…¥æ¡†
            for (let i = 1; i <= 6; i++) {
                html += `<td><input type="text" class="filter-input" id="tailOddEven${i}" placeholder="è®¡${i}" maxlength="1"></td>`;
            }
            
            // 012è·¯æ¯” - ç­›é€‰è¾“å…¥æ¡†
            html += `
                <td><input type="number" class="filter-input" id="road0" placeholder="0è·¯" min="0" max="6"></td>
                <td><input type="number" class="filter-input" id="road1" placeholder="1è·¯" min="0" max="6"></td>
                <td><input type="number" class="filter-input" id="road2" placeholder="2è·¯" min="0" max="6"></td>
            `;
            
            // åŒºé—´ç»Ÿè®¡ - ç­›é€‰è¾“å…¥æ¡†
            html += `
                <td><input type="number" class="filter-input" id="zone1" placeholder="ä¸€åŒº" min="0" max="6"></td>
                <td><input type="number" class="filter-input" id="zone2" placeholder="äºŒåŒº" min="0" max="6"></td>
                <td><input type="number" class="filter-input" id="zone3" placeholder="ä¸‰åŒº" min="0" max="6"></td>
            `;
            
            // å¥‡å¶æ¯” - ç­›é€‰è¾“å…¥æ¡†
            html += `
                <td><input type="number" class="filter-input" id="oddCount" placeholder="å¥‡æ•°" min="0" max="6"></td>
                <td><input type="number" class="filter-input" id="evenCount" placeholder="å¶æ•°" min="0" max="6"></td>
            `;
            
            // è´¨åˆæ¯” - ç­›é€‰è¾“å…¥æ¡†
            html += `
                <td><input type="number" class="filter-input" id="primeCount" placeholder="è´¨æ•°" min="0" max="6"></td>
                <td><input type="number" class="filter-input" id="compositeCount" placeholder="åˆæ•°" min="0" max="6"></td>
            `;
            
            // å¤§å°æ¯” - ç­›é€‰è¾“å…¥æ¡†
            html += `
                <td><input type="number" class="filter-input" id="smallCount" placeholder="å°æ•°" min="0" max="6"></td>
                <td><input type="number" class="filter-input" id="largeCount" placeholder="å¤§æ•°" min="0" max="6"></td>
            `;            
            
            // å‚æ•°ä¿¡æ¯ - ç­›é€‰è¾“å…¥æ¡†
            html += `
                <td><input type="number" class="filter-input" id="sumValue" placeholder="å’Œå€¼" min="21" max="183"></td>
                <td><input type="number" class="filter-input" id="spanValue" placeholder="è·¨åº¦" min="5" max="32"></td>
                <td><input type="number" class="filter-input" id="acValue" placeholder="ACå€¼" min="0" max="10"></td>
                <td>--</td>
            `;

            emptyRow.innerHTML = html;
            
            // ä¸ºæ‰€æœ‰è¾“å…¥æ¡†æ·»åŠ è¾“å…¥ç›‘å¬äº‹ä»¶
            setTimeout(() => {
                const inputs = emptyRow.querySelectorAll('.filter-input');
                inputs.forEach(input => {
                    input.addEventListener('input', debounce(saveFilterConditions, 500));
                });
            }, 0);
            
            return emptyRow;
        }

        // æ¸²æŸ“ç­›é€‰åŠŸèƒ½åŒºè¡¨æ ¼
        function renderRoadTable(data) {
            const tableBody = document.getElementById('roadTableBody');
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="49" style="text-align: center; color: #bdc3c7; padding: 20px;">æš‚æ— æ•°æ®ï¼Œè¯·å¯¼å…¥Excelæ–‡ä»¶</td></tr>';
                return;
            }
            
            const displayData = data.slice(-PERFORMANCE_CONFIG.MAX_ROWS);
            const fragment = document.createDocumentFragment();
            
            // è®¡ç®—è®°å½•æ•°å­—å¹¶è‡ªåŠ¨ç‚¹äº®çº¢çƒ
            let autoExcludedNumbers = new Set();
            
            displayData.forEach((item, index) => {
                const row = document.createElement('tr');
                const stats = calculateStatistics(item.redBalls);
                
                // è®¡ç®—è®°å½•æ•°å­—
let recordNumber = 0;
if (index > 0) {
    const previousItem = displayData[index - 1];
    recordNumber = calculateRecordNumber(item.redBalls, previousItem.redBalls);
}

// å¦‚æœæ˜¯å½“å‰æœŸï¼ˆæœ€åä¸€æ¡æ•°æ®ï¼‰ï¼Œè®¡ç®—åº”è¯¥å‚ä¸çš„å·ç 
if (index === displayData.length - 1) {
    // æ ¹æ®å½“å‰æœŸå·ç è®¡ç®—å°¾å·è¡¥å…¨
    const currentTailCompletion = calculateTailCompletionNumbers(item.redBalls);
    
    // æ¸…ç©ºå½“å‰é€‰æ‹©çŠ¶æ€
    selectedRedBalls = [];
    excludedRedBalls = [];
    
    // å°†è¡¥å…¨å·ç è®¾ä¸ºé€‰ä¸­çŠ¶æ€ï¼ˆå‚ä¸ï¼‰ï¼Œå…¶ä»–å·ç æ’é™¤
    for (let num = 1; num <= 33; num++) {
        if (currentTailCompletion.includes(num)) {
            // è¡¥å…¨å·ç  â†’ å‚ä¸é€‰æ‹©ï¼ˆé€‰ä¸­çŠ¶æ€ï¼‰
            selectedRedBalls.push(num);
        } else {
            // éè¡¥å…¨å·ç  â†’ æ’é™¤ï¼ˆç°è‰²çŠ¶æ€ï¼‰
            excludedRedBalls.push(num);
        }
    }
    
    // ä¿å­˜çŠ¶æ€
    saveRedBallState();
    
    console.log(`å½“å‰æœŸå·ç : ${item.redBalls.join(',')}`);
    console.log(`å‚ä¸é€‰æ‹©å·ç : ${currentTailCompletion.join(',')}`);
    console.log(`é€‰ä¸­æ•°é‡: ${selectedRedBalls.length}, æ’é™¤æ•°é‡: ${excludedRedBalls.length}`);
}

let html = `
    <td>${item.period}</td>
    <td>${item.weekday}</td>
`;
                
                // çº¢çƒå’Œè“çƒ
                item.redBalls.forEach(ball => {
                    html += `<td><div class="ball-3d red-ball-3d">${ball}</div></td>`;
                });
                html += `<td><div class="ball-3d blue-ball-3d">${item.blueBall}</div></td>`;
                
                // ç»Ÿè®¡çº¢çƒä½æ•°
                item.redBalls.forEach(ball => {
                    const digit = getDigitCount(ball);
                    html += `<td class="digit-${digit}">${digit}</td>`;
                });
                
                // ä½ç½®ç»Ÿè®¡çº¢çƒ
                item.redBalls.forEach((ball, index) => {
                    const positionDigit = getPositionDigit(ball);
                    html += `<td class="position-digit-${positionDigit}">${positionDigit}</td>`;
                });
                
                // å°¾å·012è·¯æ¯”
                stats.tail012Roads.forEach(road => {
                     html += `<td class="stat-value tail-road-${road}">${road}</td>`;
                });
                
                // å°¾å·å¥‡å¶ç»Ÿè®¡
                stats.tailOddEven.forEach(oddEven => {
                    const className = oddEven === 'å¥‡' ? 'tail-odd' : 'tail-even';
                    html += `<td class="stat-value ${className}">${oddEven}</td>`;
                });

                // 012è·¯æ¯”
                html += `
                    <td class="stat-value">${stats.road0}</td>
                    <td class="stat-value">${stats.road1}</td>
                    <td class="stat-value">${stats.road2}</td>
                `;
                
                // åŒºé—´ç»Ÿè®¡
                html += `
                    <td class="stat-value">${stats.zone1}</td>
                    <td class="stat-value">${stats.zone2}</td>
                    <td class="stat-value">${stats.zone3}</td>
                `;
                
                // å¥‡å¶æ¯”
                html += `
                    <td class="stat-value">${stats.odd}</td>
                    <td class="stat-value">${stats.even}</td>
                `;
                
                // è´¨åˆæ¯”
                html += `
                    <td class="stat-value">${stats.prime}</td>
                    <td class="stat-value">${stats.composite}</td>
                `;
                
                // å¤§å°æ¯”
                html += `
                    <td class="stat-value">${stats.small}</td>
                    <td class="stat-value">${stats.big}</td>
                `;
                             
                // å‚æ•°ä¿¡æ¯
                html += `
                    <td class="stat-value">${stats.sum}</td>
                    <td class="stat-value">${stats.span}</td>
                    <td class="stat-value">${stats.acValue}</td>
                    <td class="record-cell">${recordNumber}</td>
                `;
                
                row.innerHTML = html;
                fragment.appendChild(row);
            });
            
            // åœ¨æ•°æ®è¡Œåæ·»åŠ å¸¦ç­›é€‰è¾“å…¥æ¡†çš„ç©ºè¡Œ
            const emptyRow = createEmptyRow();
            fragment.appendChild(emptyRow);
            
            // æ·»åŠ åº•éƒ¨è¡¨å¤´è¡Œ
            const bottomHeaderRow = document.createElement('tr');
            bottomHeaderRow.className = 'bottom-header-row';
            bottomHeaderRow.innerHTML = `
                <td>æœŸå·</td>
                <td>æ˜ŸæœŸ</td>
                <td>çº¢1</td>
                <td>çº¢2</td>
                <td>çº¢3</td>
                <td>çº¢4</td>
                <td>çº¢5</td>
                <td>çº¢6</td>
                <td>è“çƒ</td>
                <td>1ä½</td>
                <td>2ä½</td>
                <td>3ä½</td>
                <td>4ä½</td>
                <td>5ä½</td>
                <td>6ä½</td>
                <td>ç½®1</td>
                <td>ç½®2</td>
                <td>ç½®3</td>
                <td>ç½®4</td>
                <td>ç½®5</td>
                <td>ç½®6</td>
                <td>å°¾1</td>
                <td>å°¾2</td>
                <td>å°¾3</td>
                <td>å°¾4</td>
                <td>å°¾5</td>
                <td>å°¾6</td>
                <td>è®¡1</td>
                <td>è®¡2</td>
                <td>è®¡3</td>
                <td>è®¡4</td>
                <td>è®¡5</td>
                <td>è®¡6</td>
                <td>0è·¯</td>
                <td>1è·¯</td>
                <td>2è·¯</td>
                <td>ä¸€åŒº</td>
                <td>äºŒåŒº</td>
                <td>ä¸‰åŒº</td>
                <td>å¥‡æ•°</td>
                <td>å¶æ•°</td>
                <td>è´¨æ•°</td>
                <td>åˆæ•°</td>
                <td>å°æ•°</td>
                <td>å¤§æ•°</td>
                <td>å’Œå€¼</td>
                <td>è·¨åº¦</td>
                <td>ACå€¼</td>
                <td>è®°å½•</td>
            `;
            fragment.appendChild(bottomHeaderRow);
            
            tableBody.innerHTML = '';
            tableBody.appendChild(fragment);
            
            // è‡ªåŠ¨ç‚¹äº®çº¢çƒæ€å·æ’é™¤åŒºåŸŸçš„å·ç 
            if (autoExcludedNumbers.size > 0) {
                autoExcludedNumbers.forEach(number => {
                    const redBallElement = document.querySelector(`.red-ball[data-number="${number}"]`);
                    if (redBallElement && !redBallElement.classList.contains('excluded')) {
                        redBallElement.click(); // æ¨¡æ‹Ÿç‚¹å‡»æ¥æ’é™¤è¿™ä¸ªå·ç 
                    }
                });
            }
            
            // åŠ è½½ä¿å­˜çš„ç­›é€‰æ¡ä»¶
            loadFilterConditions();
        }

        // ç»˜åˆ¶ä¸€äºŒåŒºè“çƒèµ°åŠ¿è¿æ¥çº¿
        function drawZoneTrendLines(data) {
            const linesContainer = document.getElementById('zoneTrendLinesContainer');
            linesContainer.innerHTML = '';
            
            if (data.length < 2) return;
            
            const table = document.getElementById('blueTable');
            const tableRect = table.getBoundingClientRect();
            const tableBody = document.getElementById('blueTableBody');
            const rows = tableBody.getElementsByTagName('tr');
            
            // ä¸€äºŒåŒºè“çƒåˆ—çš„èµ·å§‹ç´¢å¼•
            const zone1StartCol = 13; // ä¸€åŒºè“çƒå¼€å§‹åˆ— (1-8)
            const zone2StartCol = 21; // äºŒåŒºè“çƒå¼€å§‹åˆ— (9-16)
            
            for (let i = 0; i < data.length - 1; i++) {
                const currentData = data[i];
                const nextData = data[i + 1];
                const currentRow = rows[i];
                const nextRow = rows[i + 1];
                
                if (!currentRow || !nextRow) continue;
                
                // è·å–å½“å‰æœŸè“çƒå·ç æ‰€åœ¨çš„åˆ—ç´¢å¼•
                let currentColIndex;
                if (currentData.blueBall <= 8) {
                    currentColIndex = zone1StartCol + (currentData.blueBall - 1);
                } else {
                    currentColIndex = zone2StartCol + (currentData.blueBall - 9);
                }
                
                // è·å–ä¸‹ä¸€æœŸè“çƒå·ç æ‰€åœ¨çš„åˆ—ç´¢å¼•
                let nextColIndex;
                if (nextData.blueBall <= 8) {
                    nextColIndex = zone1StartCol + (nextData.blueBall - 1);
                } else {
                    nextColIndex = zone2StartCol + (nextData.blueBall - 9);
                }
                
                const currentCell = currentRow.cells[currentColIndex];
                const nextCell = nextRow.cells[nextColIndex];
                
                if (!currentCell || !nextCell) continue;
                
                const currentBall = currentCell.querySelector('.ball-3d');
                const nextBall = nextCell.querySelector('.ball-3d');
                
                if (!currentBall || !nextBall) continue;
                
                const currentRect = currentBall.getBoundingClientRect();
                const nextRect = nextBall.getBoundingClientRect();
                
                // è®¡ç®—è¿æ¥çº¿çš„èµ·ç‚¹å’Œç»ˆç‚¹
                const startX = currentRect.left + currentRect.width / 2 - tableRect.left;
                const startY = currentRect.top + currentRect.height / 2 - tableRect.top;
                const endX = nextRect.left + nextRect.width / 2 - tableRect.left;
                const endY = nextRect.top + nextRect.height / 2 - tableRect.top;
                
                // è®¡ç®—è¿æ¥çº¿çš„é•¿åº¦å’Œè§’åº¦
                const length = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
                
                // åˆ›å»ºè¿æ¥çº¿
                const line = document.createElement('div');
                line.className = 'zone-trend-line';
                line.style.width = length + 'px';
                line.style.left = startX + 'px';
                line.style.top = startY + 'px';
                line.style.transform = `rotate(${angle}deg)`;
                
                linesContainer.appendChild(line);
            }
        }

        // æ¸²æŸ“è“çƒèµ°åŠ¿è¡¨æ ¼
        function renderBlueTable(data) {
            const tableBody = document.getElementById('blueTableBody');
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="29" style="text-align: center; color: #bdc3c7; padding: 20px;">æš‚æ— æ•°æ®ï¼Œè¯·å¯¼å…¥Excelæ–‡ä»¶</td></tr>';
                return;
            }
            
            // ç§»é™¤é™åˆ¶ï¼Œä½¿ç”¨å®Œæ•´çš„è¿‡æ»¤åæ•°æ®
            const displayData = [...data];
            
            const fragment = document.createDocumentFragment();
            
            displayData.forEach(item => {
                const row = document.createElement('tr');
                const isBig = item.blueBall > 8;
                const isOdd = item.blueBall % 2 === 1;
                const road = item.blueBall % 3;
                const stat0Class = road === 0 ? 'stat-one' : 'stat-zero';
                const stat1Class = road === 1 ? 'stat-one' : 'stat-zero';
                const stat2Class = road === 2 ? 'stat-one' : 'stat-zero';
                
                // ç”Ÿæˆä¸€åŒºè“çƒHTML
                let zone1HTML = '';
                for (let i = 1; i <= 8; i++) {
                    zone1HTML += `<td class="zone-cell">${item.blueBall === i ? `<div class="ball-3d zone-1-ball">${i}</div>` : ''}</td>`;
                }
                
                // ç”ŸæˆäºŒåŒºè“çƒHTML
                let zone2HTML = '';
                for (let i = 9; i <= 16; i++) {
                    zone2HTML += `<td class="zone-cell">${item.blueBall === i ? `<div class="ball-3d zone-2-ball">${i}</div>` : ''}</td>`;
                }
                
                row.innerHTML = `
                    <td>${item.period}</td>
                    <td>${item.weekday}</td>
                    <td class="col-group-1"><div class="ball-3d blue-ball-3d">${item.blueBall}</div></td>
                    
                    <!-- å¤§å°åŒº -->
                    <td>${isBig ? '<span class="size-big">å¤§</span>' : ''}</td>
                    <td class="col-group-2">${!isBig ? '<span class="size-small">å°</span>' : ''}</td>
                    
                    <!-- å¥‡å¶åŒº -->
                    <td>${isOdd ? '<span class="odd">å¥‡</span>' : ''}</td>
                    <td class="col-group-3">${!isOdd ? '<span class="even">å¶</span>' : ''}</td>
                    
                    <!-- 012è·¯åŒº -->
                    <td>${road === 0 ? '<span class="road-0">0</span>' : ''}</td>
                    <td>${road === 1 ? '<span class="road-1">1</span>' : ''}</td>
                    <td class="col-group-4">${road === 2 ? '<span class="road-2">2</span>' : ''}</td>
                    
                    <!-- 012ç»Ÿè®¡ -->
                    <td class="stat-cell ${stat0Class}">${road === 0 ? '1' : '0'}</td>
                    <td class="stat-cell ${stat1Class}">${road === 1 ? '1' : '0'}</td>
                    <td class="col-group-5 stat-cell ${stat2Class}">${road === 2 ? '1' : '0'}</td>
                    
                    <!-- ä¸€åŒºè“çƒå’ŒäºŒåŒºè“çƒ -->
                    ${zone1HTML}
                    ${zone2HTML}
                `;
                fragment.appendChild(row);
            });
            
            tableBody.innerHTML = '';
            tableBody.appendChild(fragment);
            
            // å»¶è¿Ÿç»˜åˆ¶è¿æ¥çº¿ï¼Œç¡®ä¿DOMå·²æ¸²æŸ“
            setTimeout(() => {
                drawZoneTrendLines(displayData);
            }, 100);
        }

        // æ•°æ®è¿‡æ»¤åŠŸèƒ½
        function filterData() {
            const yearFilter = document.getElementById('year').value;
            const weekdayFilter = document.getElementById('weekday').value;
            const periodFilter = document.getElementById('period').value;
            
            let filteredData = [...allLotteryData];
            let filteredRoadData = [...allRoadData];
            
            if (yearFilter !== 'all') {
                filteredData = filteredData.filter(item => item.period.startsWith(yearFilter));
                filteredRoadData = filteredRoadData.filter(item => item.period.startsWith(yearFilter));
            }
            
            if (weekdayFilter !== 'all') {
                filteredData = filteredData.filter(item => item.weekday === weekdayFilter);
                filteredRoadData = filteredRoadData.filter(item => item.weekday === weekdayFilter);
            }
            
            let periodCount;
            if (periodFilter === 'å…¨éƒ¨æ•°æ®') {
                periodCount = filteredData.length;
            } else {
                periodCount = parseInt(periodFilter.replace('æœŸ', ''));
                filteredData = filteredData.slice(-periodCount);
                filteredRoadData = filteredRoadData.slice(-periodCount);
            }
            
            console.log(`æ˜¾ç¤ºæœ€è¿‘ ${periodCount} æœŸæ•°æ®`);
            renderBlueTable(filteredData);
            renderRoadTable(filteredRoadData);
        }

        // æ›´æ–°å¹´ä»½è¿‡æ»¤å™¨
        function updateYearFilter() {
            const yearSelect = document.getElementById('year');
            yearSelect.innerHTML = '<option value="all">å…¨éƒ¨</option>';
            const years = new Set();
            allLotteryData.forEach(item => {
                const year = item.period.substring(0, 4);
                if (year && year.length === 4) years.add(year);
            });
            const sortedYears = Array.from(years).sort((a, b) => b - a);
            sortedYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            });
            if (sortedYears.length > 0) yearSelect.value = sortedYears[0];
        }

        // Excelå¯¼å…¥å¤„ç†
        function handleExcelImport() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.xlsx, .xls, .csv';
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const importBtn = document.getElementById('excelImportBtn');
                const originalText = importBtn.textContent;
                importBtn.textContent = 'å¯¼å…¥ä¸­...';
                importBtn.disabled = true;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        processExcelData(jsonData);
                    } catch (error) {
                        console.error('Excelå¯¼å…¥é”™è¯¯:', error);
                        alert('æ–‡ä»¶å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                    } finally {
                        importBtn.textContent = originalText;
                        importBtn.disabled = false;
                    }
                };
                reader.onerror = function() {
                    importBtn.textContent = originalText;
                    importBtn.disabled = false;
                    alert('æ–‡ä»¶è¯»å–å¤±è´¥');
                };
                reader.readAsArrayBuffer(file);
            };
            fileInput.click();
        }

        // å¤„ç†Excelæ•°æ®
        function processExcelData(excelData) {
            allLotteryData.length = 0;
            allRoadData.length = 0;
            
            for (let i = 1; i < excelData.length; i++) {
                const row = excelData[i];
                if (!row || row.length < 9) continue;
                
                const period = row[0]?.toString() || '';
                const redBall1 = parseInt(row[1]) || 0;
                const redBall2 = parseInt(row[2]) || 0;
                const redBall3 = parseInt(row[3]) || 0;
                const redBall4 = parseInt(row[4]) || 0;
                const redBall5 = parseInt(row[5]) || 0;
                const redBall6 = parseInt(row[6]) || 0;
                const blueBall = parseInt(row[7]) || 0;
                const weekdayNum = parseInt(row[8]) || 2;
                
                if (!period || blueBall < 1 || blueBall > 16) continue;
                
                let weekday;
                switch(weekdayNum) {
                    case 2: weekday = 'äºŒ'; break;
                    case 4: weekday = 'å››'; break;
                    case 7: weekday = 'æ—¥'; break;
                    default: weekday = 'äºŒ';
                }
                
                const redBalls = [redBall1, redBall2, redBall3, redBall4, redBall5, redBall6]
                    .filter(ball => ball >= 1 && ball <= 33)
                    .sort((a, b) => a - b);
                
                if (redBalls.length !== 6) continue;
                
                allLotteryData.push({ period, weekday, blueBall });
                allRoadData.push({ period, weekday, redBalls, blueBall });
            }
            
            allLotteryData.sort((a, b) => a.period.localeCompare(b.period));
            allRoadData.sort((a, b) => a.period.localeCompare(b.period));
            
            saveDataToLocalStorage();
            
            updateYearFilter();
            updateImportButton();
            filterData();
        }

        // è¡¨æ ¼æŠ˜å åŠŸèƒ½
        function setupTableCollapse(type) {
            const title = document.getElementById(`${type}Title`);
            const tableContainer = document.getElementById(`${type}TableContainer`);
            const footer = document.getElementById(`${type}Footer`);
            const collapseBtn = title.querySelector('.collapse-btn');
            const footerBtn = footer.querySelector('.footer-collapse-btn');
            let isCollapsed = true;
            
            function toggleTable() {
                isCollapsed = !isCollapsed;
                
                if (isCollapsed) {
                    tableContainer.classList.add('collapsed');
                    collapseBtn.textContent = 'â–¶';
                    footerBtn.classList.add('collapsed');
                    footerBtn.textContent = 'ï¸½';
                    
                    setTimeout(() => {
                        tableContainer.style.pointerEvents = 'none';
                    }, PERFORMANCE_CONFIG.ANIMATION_DURATION);
                } else {
                    tableContainer.style.pointerEvents = 'auto';
                    tableContainer.classList.remove('collapsed');
                    collapseBtn.textContent = 'â–¼';
                    footerBtn.classList.remove('collapsed');
                    footerBtn.textContent = 'ï¸¾';
                }
            }
            
            title.addEventListener('click', toggleTable);
            footer.addEventListener('click', toggleTable);
        }

        // è¿‡æ»¤åˆ†æåŠŸèƒ½
        function saveToLocalStorage(key, data) {
            try { localStorage.setItem(key, JSON.stringify(data)); } catch (e) { console.warn('localStorageä¿å­˜å¤±è´¥:', e); }
        }

        function loadFromLocalStorage(key, defaultValue = null) {
            try { const data = localStorage.getItem(key); return data ? JSON.parse(data) : defaultValue; } 
            catch (e) { console.warn('localStorageè¯»å–å¤±è´¥:', e); return defaultValue; }
        }

        function initializeStoredData() {
            const storedActiveConditions = loadFromLocalStorage(STORAGE_KEYS.ACTIVE_CONDITIONS);
            if (storedActiveConditions) activeConditions = storedActiveConditions;
        }

        function initBlueFilter() {
            const allNumbers = Array.from({length: 16}, (_, i) => i + 1);
            const killBallsContainer = document.getElementById('kill-balls');
            killBallsContainer.innerHTML = '';
            
            allNumbers.forEach(num => {
                const ball = document.createElement('div');
                ball.className = 'kill-ball';
                if (num <= 8) ball.classList.add('small-ball');
                else ball.classList.add('big-ball');
                ball.textContent = num;
                ball.dataset.number = num;
                if (excludedBlueBalls.includes(num)) ball.classList.add('excluded');
                
                ball.addEventListener('click', function() {
                    const number = parseInt(this.dataset.number);
                    const index = excludedBlueBalls.indexOf(number);
                    if (index === -1) { 
                        excludedBlueBalls.push(number); 
                        this.classList.add('excluded'); 
                        selectedBlueBalls = selectedBlueBalls.filter(n => n !== number);
                    } else { 
                        excludedBlueBalls.splice(index, 1); 
                        this.classList.remove('excluded'); 
                    }
                    saveToLocalStorage(STORAGE_KEYS.EXCLUDED_BLUE_BALLS, excludedBlueBalls);
                    saveToLocalStorage(STORAGE_KEYS.SELECTED_BLUE_BALLS, selectedBlueBalls);
                    updateFilterResults();
                });
                killBallsContainer.appendChild(ball);
            });
            
            document.querySelectorAll('#blueFilterPanel .filter-btn').forEach(btn => {
                if (activeConditions.includes(btn.dataset.filter)) btn.classList.add('active');
            });
            
            document.getElementById('blueFilterPanel').addEventListener('click', function(e) {
                if (e.target.classList.contains('filter-btn')) {
                    e.target.classList.toggle('active');
                    updateActiveConditions();
                    updateFilterResults();
                }
            });
            
            document.getElementById('reset-filter-btn').addEventListener('click', function() {
                document.querySelectorAll('#blueFilterPanel .filter-btn').forEach(btn => btn.classList.remove('active'));
                excludedBlueBalls = [];
                document.querySelectorAll('#kill-balls .kill-ball').forEach(ball => ball.classList.remove('excluded'));
                activeConditions = [];
                saveToLocalStorage(STORAGE_KEYS.ACTIVE_CONDITIONS, activeConditions);
                saveToLocalStorage(STORAGE_KEYS.EXCLUDED_BLUE_BALLS, excludedBlueBalls);
                updateFilterResults();
            });
            updateFilterResults();
        }

        function updateActiveConditions() {
            activeConditions = [];
            document.querySelectorAll('#blueFilterPanel .filter-btn.active').forEach(btn => activeConditions.push(btn.dataset.filter));
            saveToLocalStorage(STORAGE_KEYS.ACTIVE_CONDITIONS, activeConditions);
        }

        function updateFilterResults() {
            const allNumbers = Array.from({length: 16}, (_, i) => i + 1);
            const conditions = {
                small: [1,2,3,4,5,6,7,8], 
                big: [9,10,11,12,13,14,15,16],
                odd: [1,3,5,7,9,11,13,15], 
                even: [2,4,6,8,10,12,14,16],
                road0: [3,6,9,12,15], 
                road1: [1,4,7,10,13,16], 
                road2: [2,5,8,11,14]
            };
            
            let result = [...allNumbers];
            if (activeConditions.length > 0) {
                result = result.filter(num => activeConditions.every(condition => conditions[condition].includes(num)));
            }
            result = result.filter(num => !excludedBlueBalls.includes(num));
            
            const resultContainer = document.getElementById('result-numbers');
            resultContainer.innerHTML = '';
            if (result.length > 0) {
                result.forEach(num => {
                    const div = document.createElement('div');
                    div.className = 'result-number';
                    div.textContent = num;
                    resultContainer.appendChild(div);
                });
            } else {
                resultContainer.innerHTML = '<div class="no-result">æ— ç¬¦åˆæ¡ä»¶å·ç </div>';
            }
        }

        // å½©ç¥¨ç­›é€‰å·¥å…·åŠŸèƒ½
        const primes = [2,3,5,7,11,13,17,19,23,29,31];

        // è®¡ç®—ç¬¦åˆæ¡ä»¶çš„çœŸå®ç»„æ•°
        function calculateRealCombinationCount(conditions) {
            let count = 0;
            // åªä»é€‰ä¸­çš„çº¢çƒä¸­ç”Ÿæˆç»„åˆï¼ˆæ’é™¤è¢«æ’é™¤çš„çº¢çƒï¼‰
            const availableNumbers = Array.from({length: 33}, (_, i) => i + 1)
                .filter(num => !excludedRedBalls.includes(num));
            const maxCalculations = 100000;
            
            function calculate(start, current, zoneCounts, oddCount, smallCount, primeCount, roadCounts, tailRoadCounts, tailOddEvenCounts) {
                if (count >= maxCalculations) return;
                
                if (current.length === 6) {
                    if (checkCombination(current, conditions)) {
                        count++;
                    }
                    return;
                }
                
                for (let i = start; i < availableNumbers.length; i++) {
                    const num = availableNumbers[i];
                    const newZoneCounts = [...zoneCounts];
                    const newRoadCounts = [...roadCounts];
                    const newTailRoadCounts = [...tailRoadCounts];
                    const newTailOddEvenCounts = [...tailOddEvenCounts];
                    
                    // åŒºé—´ç»Ÿè®¡
                    if (num >= 1 && num <= 11) newZoneCounts[0]++;
                    else if (num >= 12 && num <= 22) newZoneCounts[1]++;
                    else if (num >= 23 && num <= 33) newZoneCounts[2]++;
                    
                    if (conditions.zone1 && newZoneCounts[0] > parseInt(conditions.zone1)) continue;
                    if (conditions.zone2 && newZoneCounts[1] > parseInt(conditions.zone2)) continue;
                    if (conditions.zone3 && newZoneCounts[2] > parseInt(conditions.zone3)) continue;
                    
                    const newOddCount = oddCount + (num % 2);
                    const newSmallCount = smallCount + (num <= 16 ? 1 : 0);
                    const newPrimeCount = primeCount + (primes.includes(num) ? 1 : 0);
                    newRoadCounts[num % 3]++;
                    
                    // å°¾å·ç»Ÿè®¡
                    const tailDigit = num % 10;
                    newTailRoadCounts[tailDigit % 3]++;
                    newTailOddEvenCounts[tailDigit % 2]++;
                    
                    if (conditions.oddCount && newOddCount > parseInt(conditions.oddCount)) continue;
                    if (conditions.smallCount && newSmallCount > parseInt(conditions.smallCount)) continue;
                    if (conditions.primeCount && newPrimeCount > parseInt(conditions.primeCount)) continue;
                    if (conditions.road0 && newRoadCounts[0] > parseInt(conditions.road0)) continue;
                    if (conditions.road1 && newRoadCounts[1] > parseInt(conditions.road1)) continue;
                    if (conditions.road2 && newRoadCounts[2] > parseInt(conditions.road2)) continue;
                    
                    // ä½æ•°ç»Ÿè®¡æ£€æŸ¥
                    const currentLength = current.length;
                    if (conditions[`digit${currentLength + 1}`]) {
                        const expectedDigit = parseInt(conditions[`digit${currentLength + 1}`]);
                        const actualDigit = getDigitCount(num);
                        if (actualDigit !== expectedDigit) continue;
                    }
                    
                    // ä½ç½®ç»Ÿè®¡æ£€æŸ¥
                    if (conditions[`position${currentLength + 1}`]) {
                        const expectedPosition = parseInt(conditions[`position${currentLength + 1}`]);
                        const actualPosition = getPositionDigit(num);
                        if (actualPosition !== expectedPosition) continue;
                    }
                    
                    // å°¾å·012è·¯æ£€æŸ¥
                    if (conditions[`tailRoad${currentLength + 1}`]) {
                        const expectedTailRoad = parseInt(conditions[`tailRoad${currentLength + 1}`]);
                        const actualTailRoad = (num % 10) % 3;
                        if (actualTailRoad !== expectedTailRoad) continue;
                    }
                    
                    // å°¾å·å¥‡å¶æ£€æŸ¥
                    if (conditions[`tailOddEven${currentLength + 1}`]) {
                        const expectedTailOddEven = conditions[`tailOddEven${currentLength + 1}`];
                        const actualTailOddEven = (num % 10) % 2 === 1 ? 'å¥‡' : 'å¶';
                        if (actualTailOddEven !== expectedTailOddEven) continue;
                    }
                    
                    current.push(num);
                    calculate(i + 1, current, newZoneCounts, newOddCount, newSmallCount, newPrimeCount, newRoadCounts, newTailRoadCounts, newTailOddEvenCounts);
                    current.pop();
                }
            }
            
            calculate(0, [], [0,0,0], 0, 0, 0, [0,0,0], [0,0,0], [0,0]);
            return count;
        }

        // ç”Ÿæˆç¬¦åˆæ¡ä»¶çš„ç»„åˆ
        function generateCombinations(conditions) {
            const combinations = [];
            // åªä»é€‰ä¸­çš„çº¢çƒä¸­ç”Ÿæˆç»„åˆï¼ˆæ’é™¤è¢«æ’é™¤çš„çº¢çƒï¼‰
            const availableNumbers = Array.from({length: 33}, (_, i) => i + 1)
                .filter(num => !excludedRedBalls.includes(num));
            
            function generate(start, current, zoneCounts, oddCount, smallCount, primeCount, roadCounts, tailRoadCounts, tailOddEvenCounts) {
                if (current.length === 6) {
                    if (checkCombination(current, conditions)) {
                        combinations.push([...current]);
                    }
                    return;
                }
                
                for (let i = start; i < availableNumbers.length; i++) {
                    const num = availableNumbers[i];
                    const newZoneCounts = [...zoneCounts];
                    const newRoadCounts = [...roadCounts];
                    const newTailRoadCounts = [...tailRoadCounts];
                    const newTailOddEvenCounts = [...tailOddEvenCounts];
                    
                    // åŒºé—´ç»Ÿè®¡
                    if (num >= 1 && num <= 11) newZoneCounts[0]++;
                    else if (num >= 12 && num <= 22) newZoneCounts[1]++;
                    else if (num >= 23 && num <= 33) newZoneCounts[2]++;
                    
                    if (conditions.zone1 && newZoneCounts[0] > parseInt(conditions.zone1)) continue;
                    if (conditions.zone2 && newZoneCounts[1] > parseInt(conditions.zone2)) continue;
                    if (conditions.zone3 && newZoneCounts[2] > parseInt(conditions.zone3)) continue;
                    
                    const newOddCount = oddCount + (num % 2);
                    const newSmallCount = smallCount + (num <= 16 ? 1 : 0);
                    const newPrimeCount = primeCount + (primes.includes(num) ? 1 : 0);
                    newRoadCounts[num % 3]++;
                    
                    // å°¾å·ç»Ÿè®¡
                    const tailDigit = num % 10;
                    newTailRoadCounts[tailDigit % 3]++;
                    newTailOddEvenCounts[tailDigit % 2]++;
                    
                    if (conditions.oddCount && newOddCount > parseInt(conditions.oddCount)) continue;
                    if (conditions.smallCount && newSmallCount > parseInt(conditions.smallCount)) continue;
                    if (conditions.primeCount && newPrimeCount > parseInt(conditions.primeCount)) continue;
                    if (conditions.road0 && newRoadCounts[0] > parseInt(conditions.road0)) continue;
                    if (conditions.road1 && newRoadCounts[1] > parseInt(conditions.road1)) continue;
                    if (conditions.road2 && newRoadCounts[2] > parseInt(conditions.road2)) continue;
                    
                    // ä½æ•°ç»Ÿè®¡æ£€æŸ¥
                    const currentLength = current.length;
                    if (conditions[`digit${currentLength + 1}`]) {
                        const expectedDigit = parseInt(conditions[`digit${currentLength + 1}`]);
                        const actualDigit = getDigitCount(num);
                        if (actualDigit !== expectedDigit) continue;
                    }
                    
                    // ä½ç½®ç»Ÿè®¡æ£€æŸ¥
                    if (conditions[`position${currentLength + 1}`]) {
                        const expectedPosition = parseInt(conditions[`position${currentLength + 1}`]);
                        const actualPosition = getPositionDigit(num);
                        if (actualPosition !== expectedPosition) continue;
                    }
                    
                    // å°¾å·012è·¯æ£€æŸ¥
                    if (conditions[`tailRoad${currentLength + 1}`]) {
                        const expectedTailRoad = parseInt(conditions[`tailRoad${currentLength + 1}`]);
                        const actualTailRoad = (num % 10) % 3;
                        if (actualTailRoad !== expectedTailRoad) continue;
                    }
                    
                    // å°¾å·å¥‡å¶æ£€æŸ¥
                    if (conditions[`tailOddEven${currentLength + 1}`]) {
                        const expectedTailOddEven = conditions[`tailOddEven${currentLength + 1}`];
                        const actualTailOddEven = (num % 10) % 2 === 1 ? 'å¥‡' : 'å¶';
                        if (actualTailOddEven !== expectedTailOddEven) continue;
                    }
                    
                    current.push(num);
                    generate(i + 1, current, newZoneCounts, newOddCount, newSmallCount, newPrimeCount, newRoadCounts, newTailRoadCounts, newTailOddEvenCounts);
                    current.pop();
                }
            }
            
            generate(0, [], [0,0,0], 0, 0, 0, [0,0,0], [0,0,0], [0,0]);
            return combinations;
        }

        // æ£€æŸ¥å·ç ç»„åˆæ˜¯å¦ç¬¦åˆæ¡ä»¶
        function checkCombination(combination, conditions) {
            if (combination.length !== 6) return false;
            
            // æ£€æŸ¥ä½æ•°ç»Ÿè®¡
            for (let i = 0; i < 6; i++) {
                if (conditions[`digit${i + 1}`]) {
                    const expectedDigit = parseInt(conditions[`digit${i + 1}`]);
                    const actualDigit = getDigitCount(combination[i]);
                    if (actualDigit !== expectedDigit) return false;
                }
            }
            
            // æ£€æŸ¥ä½ç½®ç»Ÿè®¡
            for (let i = 0; i < 6; i++) {
                if (conditions[`position${i + 1}`]) {
                    const expectedPosition = parseInt(conditions[`position${i + 1}`]);
                    const actualPosition = getPositionDigit(combination[i]);
                    if (actualPosition !== expectedPosition) return false;
                }
            }
            
            // æ£€æŸ¥å°¾å·012è·¯
            for (let i = 0; i < 6; i++) {
                if (conditions[`tailRoad${i + 1}`]) {
                    const expectedTailRoad = parseInt(conditions[`tailRoad${i + 1}`]);
                    const actualTailRoad = (combination[i] % 10) % 3;
                    if (actualTailRoad !== expectedTailRoad) return false;
                }
            }
            
            // æ£€æŸ¥å°¾å·å¥‡å¶
            for (let i = 0; i < 6; i++) {
                if (conditions[`tailOddEven${i + 1}`]) {
                    const expectedTailOddEven = conditions[`tailOddEven${i + 1}`];
                    const actualTailOddEven = (combination[i] % 10) % 2 === 1 ? 'å¥‡' : 'å¶';
                    if (actualTailOddEven !== expectedTailOddEven) return false;
                }
            }
            
            if (conditions.sumValue) {
                const sum = combination.reduce((a, b) => a + b, 0);
                if (sum !== parseInt(conditions.sumValue)) return false;
            }
            
            if (conditions.spanValue) {
                const span = Math.max(...combination) - Math.min(...combination);
                if (span !== parseInt(conditions.spanValue)) return false;
            }
            
            if (conditions.acValue) {
                const ac = calculateAC(combination);
                if (ac !== parseInt(conditions.acValue)) return false;
            }
            
            if (conditions.zone1 || conditions.zone2 || conditions.zone3) {
                const zoneCounts = [0, 0, 0];
                combination.forEach(num => {
                    if (num >= 1 && num <= 11) zoneCounts[0]++;
                    else if (num >= 12 && num <= 22) zoneCounts[1]++;
                    else if (num >= 23 && num <= 33) zoneCounts[2]++;
                });
                
                if (conditions.zone1 && zoneCounts[0] !== parseInt(conditions.zone1)) return false;
                if (conditions.zone2 && zoneCounts[1] !== parseInt(conditions.zone2)) return false;
                if (conditions.zone3 && zoneCounts[2] !== parseInt(conditions.zone3)) return false;
            }
            
            if (conditions.oddCount || conditions.evenCount) {
                const oddCount = combination.filter(num => num % 2 === 1).length;
                const evenCount = 6 - oddCount;
                
                if (conditions.oddCount && oddCount !== parseInt(conditions.oddCount)) return false;
                if (conditions.evenCount && evenCount !== parseInt(conditions.evenCount)) return false;
            }
            
            if (conditions.smallCount || conditions.largeCount) {
                const smallCount = combination.filter(num => num <= 16).length;
                const largeCount = 6 - smallCount;
                
                if (conditions.smallCount && smallCount !== parseInt(conditions.smallCount)) return false;
                if (conditions.largeCount && largeCount !== parseInt(conditions.largeCount)) return false;
            }
            
            if (conditions.primeCount || conditions.compositeCount) {
                const primeCount = combination.filter(num => primes.includes(num)).length;
                const compositeCount = 6 - primeCount;
                
                if (conditions.primeCount && primeCount !== parseInt(conditions.primeCount)) return false;
                if (conditions.compositeCount && compositeCount !== parseInt(conditions.compositeCount)) return false;
            }
            
            if (conditions.road0 || conditions.road1 || conditions.road2) {
                const roadCounts = [0, 0, 0];
                combination.forEach(num => {
                    roadCounts[num % 3]++;
                });
                
                if (conditions.road0 && roadCounts[0] !== parseInt(conditions.road0)) return false;
                if (conditions.road1 && roadCounts[1] !== parseInt(conditions.road1)) return false;
                if (conditions.road2 && roadCounts[2] !== parseInt(conditions.road2)) return false;
            }
            
            return true;
        }

        // è®¡ç®—ACå€¼
        function calculateAC(combination) {
            const diffs = new Set();
            
            for (let i = 0; i < combination.length; i++) {
                for (let j = i + 1; j < combination.length; j++) {
                    diffs.add(Math.abs(combination[i] - combination[j]));
                }
            }
            
            return diffs.size - (combination.length - 1);
        }

        // è·å–ç­›é€‰æ¡ä»¶
        function getFilterConditions() {
            const conditions = {
                sumValue: document.getElementById('sumValue').value,
                spanValue: document.getElementById('spanValue').value,
                acValue: document.getElementById('acValue').value,
                zone1: document.getElementById('zone1').value,
                zone2: document.getElementById('zone2').value,
                zone3: document.getElementById('zone3').value,
                oddCount: document.getElementById('oddCount').value,
                evenCount: document.getElementById('evenCount').value,
                smallCount: document.getElementById('smallCount').value,
                largeCount: document.getElementById('largeCount').value,
                primeCount: document.getElementById('primeCount').value,
                compositeCount: document.getElementById('compositeCount').value,
                road0: document.getElementById('road0').value,
                road1: document.getElementById('road1').value,
                road2: document.getElementById('road2').value
            };
            
            // æ·»åŠ ä½æ•°ç»Ÿè®¡æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                conditions[`digit${i}`] = document.getElementById(`digit${i}`).value;
            }
            
            // æ·»åŠ ä½ç½®ç»Ÿè®¡æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                conditions[`position${i}`] = document.getElementById(`position${i}`).value;
            }
            
            // æ·»åŠ å°¾å·012è·¯æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                conditions[`tailRoad${i}`] = document.getElementById(`tailRoad${i}`).value;
            }
            
            // æ·»åŠ å°¾å·å¥‡å¶æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                conditions[`tailOddEven${i}`] = document.getElementById(`tailOddEven${i}`).value;
            }
            
            return conditions;
        }

        // è®¡ç®—ç»„æ•°
        function calculateGroups() {
            const conditions = getFilterConditions();
            const calculationResult = document.getElementById('calculationResult');
            calculationResult.innerHTML = '<div class="loading">æ­£åœ¨è®¡ç®—ç»„æ•°...</div>';
            calculationResult.className = 'calculation-result';
            calculationResult.style.display = 'block';
            
            setTimeout(() => {
                const startTime = performance.now();
                calculatedCount = calculateRealCombinationCount(conditions);
                const endTime = performance.now();
                
                let resultClass = 'safe';
                let message = '';
                
                if (calculatedCount === 0) {
                    message = 'æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å·ç ';
                    resultClass = 'warning';
                } else if (calculatedCount <= 1000) {
                    message = `æ‰¾åˆ° ${calculatedCount} ç»„å·ç ï¼Œå¯å®‰å…¨ç”Ÿæˆ`;
                    resultClass = 'safe';
                } else {
                    message = `æ‰¾åˆ° ${calculatedCount} ç»„å·ç ï¼Œç”Ÿæˆå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´`;
                    resultClass = 'warning';
                }
                
                calculationResult.innerHTML = `
                    <div>${message}</div>
                    <div class="calculation-details">è®¡ç®—è€—æ—¶: ${(endTime - startTime).toFixed(0)} æ¯«ç§’</div>
                `;
                calculationResult.className = `calculation-result ${resultClass}`;
            }, 100);
        }

        // ç”Ÿæˆå·ç 
        function generateNumbers() {
    if (calculatedCount === 0) {
        const calculationResult = document.getElementById('calculationResult');
        calculationResult.innerHTML = '<div class="warning">è¯·å…ˆè®¡ç®—ç»„æ•°</div>';
        calculationResult.className = 'calculation-result warning';
        calculationResult.style.display = 'block';
        return;
    }
    
    if (calculatedCount > 5000) {
        const calculationResult = document.getElementById('calculationResult');
        calculationResult.innerHTML = '<div class="danger">ç»„æ•°è¿‡å¤šï¼Œå»ºè®®è°ƒæ•´æ¡ä»¶å‡å°‘ç»„æ•°</div>';
        calculationResult.className = 'calculation-result danger';
        calculationResult.style.display = 'block';
        return;
    }
    
    const startTime = performance.now();
    const conditions = getFilterConditions();
    const numberSets = document.getElementById('numberSets');
    const calculationResult = document.getElementById('calculationResult');
    
    numberSets.innerHTML = '<div class="loading">æ­£åœ¨ç”Ÿæˆå·ç ...</div>';
    
    setTimeout(() => {
        const redCombinations = generateCombinations(conditions);
        const endTime = performance.now();
        
        let finalCombinations = [];
        
        // åªä»é€‰ä¸­çš„è“çƒä¸­åˆ†é…ï¼ˆselectedBlueBallsï¼‰
        if (selectedBlueBalls.length > 0 && redCombinations.length > 0) {
            const maxDisplay = Math.min(redCombinations.length, 200);
            const selectedRedCombinations = redCombinations.slice(0, maxDisplay);
            
            finalCombinations = selectedRedCombinations.map(redBalls => {
                const randomBlueIndex = Math.floor(Math.random() * selectedBlueBalls.length);
                return {
                    redBalls: [...redBalls],
                    blueBall: selectedBlueBalls[randomBlueIndex]
                };
            });
        } else {
            // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„è“çƒï¼Œå°±ä¸ç”Ÿæˆè“çƒ
            const maxDisplay = Math.min(redCombinations.length, 200);
            finalCombinations = redCombinations.slice(0, maxDisplay).map(redBalls => ({
                redBalls: [...redBalls],
                blueBall: null
            }));
        }
        
        displayResults(finalCombinations);
        
        calculationResult.innerHTML = `
            <div>å·²ç”Ÿæˆ ${finalCombinations.length} ç»„å·ç </div>
            <div class="calculation-details">ç”Ÿæˆè€—æ—¶: ${(endTime - startTime).toFixed(0)} æ¯«ç§’</div>
        `;
        calculationResult.className = 'calculation-result safe';
    }, 100);
}

        // æ˜¾ç¤ºç»“æœ
        function displayResults(results) {
            const numberSets = document.getElementById('numberSets');
            numberSets.innerHTML = '';
            
            if (results.length === 0) {
                numberSets.innerHTML = '<p style="text-align: center; color: #bdc3c7; grid-column: 1 / -1;">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å·ç </p>';
                return;
            }
            
            results.forEach(item => {
                const setElement = document.createElement('div');
                setElement.className = 'number-set';
                
                const sortedRedBalls = [...item.redBalls].sort((a, b) => a - b);
                
                // æ·»åŠ çº¢çƒ
                sortedRedBalls.forEach(number => {
                    const numberElement = document.createElement('div');
                    numberElement.className = 'number';
                    numberElement.textContent = number;
                    
                    if (number <= 16) {
                        numberElement.classList.add('small');
                    } else {
                        numberElement.classList.add('large');
                    }
                    
                    if (number % 2 === 0) {
                        numberElement.classList.add('even');
                    } else {
                        numberElement.classList.add('odd');
                    }
                    
                    setElement.appendChild(numberElement);
                });
                
                // æ·»åŠ è“çƒï¼ˆå¦‚æœæœ‰ï¼‰
                if (item.blueBall !== null) {
                    const blueNumberElement = document.createElement('div');
                    blueNumberElement.className = 'number blue';
                    blueNumberElement.textContent = item.blueBall;
                    setElement.appendChild(blueNumberElement);
                }
                
                numberSets.appendChild(setElement);
            });
        }

        // é‡ç½®ç­›é€‰æ¡ä»¶
        function resetFilterConditions() {
            document.getElementById('sumValue').value = '';
            document.getElementById('spanValue').value = '';
            document.getElementById('acValue').value = '';
            document.getElementById('zone1').value = '';
            document.getElementById('zone2').value = '';
            document.getElementById('zone3').value = '';
            document.getElementById('oddCount').value = '';
            document.getElementById('evenCount').value = '';
            document.getElementById('smallCount').value = '';
            document.getElementById('largeCount').value = '';
            document.getElementById('primeCount').value = '';
            document.getElementById('compositeCount').value = '';
            document.getElementById('road0').value = '';
            document.getElementById('road1').value = '';
            document.getElementById('road2').value = '';
            
            // é‡ç½®ä½æ•°ç»Ÿè®¡æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`digit${i}`).value = '';
            }
            
            // é‡ç½®ä½ç½®ç»Ÿè®¡æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`position${i}`).value = '';
            }
            
            // é‡ç½®å°¾å·012è·¯æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`tailRoad${i}`).value = '';
            }
            
            // é‡ç½®å°¾å·å¥‡å¶æ¡ä»¶
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`tailOddEven${i}`).value = '';
            }
            
            // é‡ç½®è“çƒé€‰æ‹©
    selectedBlueBalls = [];
    const blueBalls = document.querySelectorAll('.blue-ball');
    blueBalls.forEach(ball => {
        ball.classList.remove('selected');
        ball.classList.add('excluded');
    });
    localStorage.removeItem(STORAGE_KEYS.SELECTED_BLUE_BALLS);
            
            // é‡ç½®çº¢çƒé€‰æ‹© - ä½¿ç”¨è¡¥å…¨å·ç é€»è¾‘
            resetRedBallsToTailCompletion();
            
            // æ¸…é™¤ä¿å­˜çš„ç­›é€‰æ¡ä»¶
            localStorage.removeItem(STORAGE_KEYS.FILTER_CONDITIONS);
            
            calculatedCount = 0;
            const calculationResult = document.getElementById('calculationResult');
            calculationResult.style.display = 'none';
            const numberSets = document.getElementById('numberSets');
            numberSets.innerHTML = '<p style="text-align: center; color: #bdc3c7; grid-column: 1 / -1;">è¯·å…ˆè®¾ç½®æ¡ä»¶å¹¶è®¡ç®—ç»„æ•°</p>';
        }

        // æ ¼å¼å¤åˆ¶åŠŸèƒ½
        function copyFormatted() {
            const numberSets = document.getElementById('numberSets');
            const sets = numberSets.querySelectorAll('.number-set');
            
            if (sets.length === 0) {
                alert('è¯·å…ˆç”Ÿæˆå·ç ');
                return;
            }

            let copyText = '';
            
            sets.forEach(set => {
                const numbers = set.querySelectorAll('.number');
                let line = '';
                
                numbers.forEach((numberEl, index) => {
                    line += numberEl.textContent;
                    if (index < numbers.length - 1) {
                        line += '\t';
                    }
                });
                
                copyText += line + '\n';
            });

            copyToClipboard(copyText.trim());
            showCopySuccess('æ ¼å¼å¤åˆ¶åˆ°Excelé‡Œ');
        }

        // æ•°é‡å¤åˆ¶åŠŸèƒ½
        function copyWithNumbers() {
            const numberSets = document.getElementById('numberSets');
            const sets = numberSets.querySelectorAll('.number-set');
            
            if (sets.length === 0) {
                alert('è¯·å…ˆç”Ÿæˆå·ç ');
                return;
            }

            // è·å–å½“å‰æ—¶é—´
            const now = new Date();
            const currentDate = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
            const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            let copyText = '';
            
            // æ·»åŠ å¤´éƒ¨ä¿¡æ¯
            copyText += `${currentDate}     ${currentTime}     å…± ${sets.length} ç»„\n`;
            copyText += '='.repeat(32) + '\n';  // åˆ†éš”çº¿
            
            let groupNumber = 1;
            
            sets.forEach(set => {
                const numbers = set.querySelectorAll('.number');
                let redBalls = [];
                let blueBall = null;
                
                numbers.forEach((numberEl, index) => {
                    if (numberEl.classList.contains('blue')) {
                        blueBall = numberEl.textContent;
                    } else {
                        redBalls.push(numberEl.textContent);
                    }
                });
                
                let numberString = '';
                
                redBalls.forEach((ball, index) => {
                    numberString += ball;
                    if (index < redBalls.length - 1) {
                        numberString += '\t';
                    }
                });
            
                if (blueBall) {
                    numberString += '\t+' + blueBall;
                }

                copyText += `${groupNumber}ç»„ï¼š${numberString}\n`;
                groupNumber++;
            });

            copyToClipboard(copyText.trim());
            showCopySuccess('æ•°é‡å¤åˆ¶æˆåŠŸï¼å·²æ·»åŠ æ—¶é—´ä¿¡æ¯');
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
        function showCopySuccess(message) {
            const calculationResult = document.getElementById('calculationResult');
            calculationResult.innerHTML = `<div>${message}</div>`;
            calculationResult.className = 'calculation-result safe';
            calculationResult.style.display = 'block';
            
            setTimeout(() => {
                calculationResult.style.display = 'none';
            }, 3000);
        }

        // åˆå§‹åŒ–åº”ç”¨
        function initializeApp() {
            document.getElementById('blueTableBody').innerHTML = '';
            document.getElementById('roadTableBody').innerHTML = '';

            // æ·»åŠ åå­—æ¶é«˜äº®æ•ˆæœ
            function setupCrossHighlight() {
                const table = document.getElementById('roadTable');
                
                table.addEventListener('mouseover', function(e) {
                    if (e.target.tagName === 'TD') {
                        const td = e.target;
                        const tr = td.parentElement;
                        const colIndex = td.cellIndex;
                        
                        // é«˜äº®æ•´è¡Œ
                        tr.classList.add('row-highlight');
                        
                        // é«˜äº®æ•´åˆ—
                        const allRows = table.querySelectorAll('tr');
                        allRows.forEach(row => {
                            if (row.cells[colIndex]) {
                                row.cells[colIndex].classList.add('col-highlight');
                            }
                        });
                    }
                });
                
                table.addEventListener('mouseout', function(e) {
                    if (e.target.tagName === 'TD') {
                        // ç§»é™¤æ‰€æœ‰é«˜äº®
                        table.querySelectorAll('.row-highlight').forEach(el => {
                            el.classList.remove('row-highlight');
                        });
                        table.querySelectorAll('.col-highlight').forEach(el => {
                            el.classList.remove('col-highlight');
                        });
                    }
                });
            }
            
            // è°ƒç”¨å‡½æ•°
            setupCrossHighlight();

            // åˆå§‹åŒ–çº¢çƒé€‰æ‹©
            initializeRedBalls();
            
            // åˆå§‹åŒ–è“çƒé€‰æ‹©
            initializeBlueBalls();

            // æ›´æ–°å½“å‰æ—¥æœŸæ˜¾ç¤º
            updateCurrentDate();

            const hasData = loadDataFromLocalStorage();
            if (hasData) {
                updateYearFilter();
                updateImportButton();
                filterData();
            } else {
                renderBlueTable([]);
                renderRoadTable([]);
            }

            // æ›´æ–°å½“å‰æ—¥æœŸæ˜¾ç¤º
            function updateCurrentDate() {
                const now = new Date();
                const currentDate = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
                document.getElementById('currentDate').textContent = currentDate;
            }

            // ç»‘å®šäº‹ä»¶
            document.getElementById('excelImportBtn').addEventListener('click', handleExcelImport);
            document.getElementById('year').addEventListener('change', filterData);
            document.getElementById('weekday').addEventListener('change', filterData);
            document.getElementById('period').addEventListener('change', filterData);
            
            // ç»‘å®šç­›é€‰æŒ‰é’®äº‹ä»¶
            document.getElementById('calculateButton').addEventListener('click', calculateGroups);
            document.getElementById('generateButton').addEventListener('click', generateNumbers);
            document.getElementById('resetButton').addEventListener('click', resetFilterConditions);
            
            // åˆå§‹åŒ–è¡¨æ ¼æŠ˜å 
            setupTableCollapse('blue');
            setupTableCollapse('filter');
            setupTableCollapse('road');
            
            initializeStoredData();
            initBlueFilter();
            
            console.log('åŒè‰²çƒç»¼åˆåˆ†æç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        }

        // DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>